<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
>
<head>
    <title>Homepage for customer</title>
    <link rel="stylesheet" href="/css/customer/homepage-customer.css">
    <style>
        .carousel-car .img img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
        }
    </style>

</head>
<body>
<th:block layout:fragment="content">
    <body>



    <div class="hero-wrap ftco-degree-bg" style="background-image: url('/images/bg_1.jpg');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text justify-content-start align-items-center justify-content-center">
                <div class="col-lg-8 ftco-animate">
                    <div class="text w-100 text-center mb-md-5 pb-md-5">
                        <h1 class="mb-4">Fast &amp; Easy Way To Rent A Car</h1>
                        <p style="font-size: 18px;">A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts</p>
                        <a href="https://vimeo.com/45830194" class="icon-wrap popup-vimeo d-flex align-items-center mt-4 justify-content-center">
                            <div class="icon d-flex align-items-center justify-content-center">
                                <span class="ion-ios-play"></span>
                            </div>
                            <div class="heading-title ml-5">
                                <span>Easy steps for renting a car</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section class="ftco-section ftco-no-pt bg-light">
        <div class="container" style="">
            <div class="row no-gutters">
                <div class="col-md-12	featured-top">
                    <div class="row no-gutters">
                        <div class="col-md-4 d-flex align-items-center justify-content-center">
                            <form th:action="@{/searchCar}" class="request-form ftco-animate bg-primary" method="get" style="min-height: 550px;align-items: center;align-content: center;gap: 20px;display: flex;flex-flow: column;">
                                <h2>Make your trip</h2>
                                <div id="error-messages" style="color: red;"></div>

                                <div class="form-group">
                                    <label for="pick-location" class="label">Pick-up location</label>
                                    <input name="name" type="text" class="form-control" placeholder="City,District " id="pick-location">
                                    <small id="pick-location-error" style="color: red;"></small>
                                </div>
                                <div class="d-flex">
                                    <div class="form-group mr-2">
                                        <label for="book_pick_dates" class="label">Pick-up date</label>
                                        <input name="pickDate" type="date" class="form-control"  placeholder="Date"  id="book_pick_dates">
                                        <small id="pick-date-error" style="color: red;"></small>
                                    </div>
                                    <div class="form-group">
                                        <label for="time_picks" class="label">Pick-up time</label>
                                        <input name="pickTime" type="time" class="form-control"  placeholder="Time" id="time_picks" value="00:00">
                                        <small id="pick-time-error" style="color: red;"></small>
                                    </div>
                                </div>

                                <div class="d-flex">
                                    <div class="form-group mr-2">
                                        <label for="book_drop_dates" class="label">Drop date</label>
                                        <input name="dropDate" type="date" class="form-control"  placeholder="Date" id="book_drop_dates">
                                        <small id="drop-date-error" style="color: red;"></small>
                                    </div>
                                    <div class="form-group">
                                        <label for="time_drops" class="label">Drop time</label>
                                        <input name="dropTime" type="time" class="form-control"  placeholder="Time"  id="time_drops" value="00:00">
                                        <small id="drop-time-error" style="color: red;"></small>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="submit" value="Rent A Car Now" class="btn btn-secondary py-3 px-4">
                                </div>
                            </form>
                        </div>
                        <div class="col-md-8 d-flex align-items-center">
                            <div class="services-wrap rounded-right w-100" style="text-align: center;">
                                <h3 class="heading-section mb-4">Better Way to Rent Your Perfect Cars</h3>
                                <div class="row d-flex mb-4">
                                    <div class="col-md-4 d-flex align-self-stretch ftco-animate">
                                        <div class="services w-100 text-center">
                                            <div class="icon d-flex align-items-center justify-content-center"><span class="flaticon-route"></span></div>
                                            <div class="text w-100">
                                                <h3 class="heading mb-2">Choose Your Pickup Location</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 d-flex align-self-stretch ftco-animate">
                                        <div class="services w-100 text-center">
                                            <div class="icon d-flex align-items-center justify-content-center"><span class="flaticon-handshake"></span></div>
                                            <div class="text w-100">
                                                <h3 class="heading mb-2">Select the Best Deal</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 d-flex align-self-stretch ftco-animate">
                                        <div class="services w-100 text-center">
                                            <div class="icon d-flex align-items-center justify-content-center"><span class="flaticon-rent"></span></div>
                                            <div class="text w-100">
                                                <h3 class="heading mb-2">Reserve Your Rental Car</h3>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p><a href="/cars" class="btn btn-primary py-3 px-4">Reserve Your Perfect Car</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section ftco-no-pt bg-light">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-12 heading-section text-center ftco-animate mb-5">
                    <span class="subheading">What we offer</span>
                    <h2 class="mb-2">Featured Vehicles</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="carousel-car owl-carousel">
                        <div th:each="car : ${topCars}">
                            <div class="item">
                                <div class="car-wrap rounded ftco-animate">
                                    <div class="img rounded d-flex align-items-end">
                                        <img th:src="'/'+${car.front}" alt="Car Image">
                                    </div>
                                    <div class="text">
                                        <h2 class="mb-0"><a href="#" th:text="${car.name}">Mercedes Grand Sedan</a></h2>
                                        <div class="d-flex mb-3">
                                            <span class="cat" th:text="${car.model}">Chevrolet</span>
                                            <p class="price ml-auto" th:text="${car.basePrice} + '/day'">$500 /day</p>
                                        </div>
                                        <p class="d-flex mb-0 d-block">
                                            <a class="btn btn-primary py-2 mr-1"
                                               th:href="@{'/customer/booking-car?CarId='+ ${car.getCarId()} + '&startDate='  + '&enDate='  + '&address=' + '&beforeNavigate=detailCar'}">Rent now</a>
                                            <a class="btn btn-secondary py-2 ml-1"
                                               th:href="@{/carDetail/{carId}(carId=${car.carId})}">Details</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="ftco-section ftco-about">
        <div class="container">
            <div class="row no-gutters">
                <div class="col-md-6 p-md-5 img img-2 d-flex justify-content-center align-items-center" style="background-image: url(/images/about.jpg);">
                </div>
                <div class="col-md-6 wrap-about ftco-animate">
                    <div class="heading-section heading-section-white pl-md-5">
                        <span class="subheading">About us</span>
                        <h2 class="mb-4">Welcome to Carbook</h2>

                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>
                        <p>On her way she met a copy. The copy warned the Little Blind Text, that where it came from it would have been rewritten a thousand times and everything that was left from its origin would be the word "and" and the Little Blind Text should turn around and return to its own, safe country. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>
                        <p>
                            <a href="#" id="searchVehicleBtn" class="btn btn-primary py-3 px-4">Search Vehicle</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section">
        <div class="container">
            <div class="row justify-content-center mb-5">
                <div class="col-md-7 text-center heading-section ftco-animate">
                    <span class="subheading">Services</span>
                    <h2 class="mb-3">Our Latest Services</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="services services-2 w-100 text-center">
                        <div class="icon d-flex align-items-center justify-content-center"><span class="flaticon-wedding-car"></span></div>
                        <div class="text w-100">
                            <h3 class="heading mb-2">Wedding Ceremony</h3>
                            <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="services services-2 w-100 text-center">
                        <div class="icon d-flex align-items-center justify-content-center"><span class="flaticon-transportation"></span></div>
                        <div class="text w-100">
                            <h3 class="heading mb-2">City Transfer</h3>
                            <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="services services-2 w-100 text-center">
                        <div class="icon d-flex align-items-center justify-content-center"><span class="flaticon-car"></span></div>
                        <div class="text w-100">
                            <h3 class="heading mb-2">Airport Transfer</h3>
                            <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="services services-2 w-100 text-center">
                        <div class="icon d-flex align-items-center justify-content-center"><span class="flaticon-transportation"></span></div>
                        <div class="text w-100">
                            <h3 class="heading mb-2">Whole City Tour</h3>
                            <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="ftco-section testimony-section bg-light">
        <div class="container">
            <div class="row justify-content-center mb-5">
                <div class="col-md-7 text-center heading-section ftco-animate">
                    <span class="subheading">Testimonial</span>
                    <h2 class="mb-3">Happy Clients</h2>
                </div>
            </div>
            <div class="row ftco-animate">
                <div class="col-md-12">
                    <div class="carousel-testimony owl-carousel ftco-owl">
                        <div class="item">
                            <div class="testimony-wrap rounded text-center py-4 pb-5">
                                <div class="user-img mb-2" style="background-image: url(/images/person_1.jpg)">
                                </div>
                                <div class="text pt-4">
                                    <p class="mb-4">Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
                                    <p class="name">Roger Scott</p>
                                    <span class="position">Marketing Manager</span>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="testimony-wrap rounded text-center py-4 pb-5">
                                <div class="user-img mb-2" style="background-image: url(/images/person_2.jpg)">
                                </div>
                                <div class="text pt-4">
                                    <p class="mb-4">Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
                                    <p class="name">Roger Scott</p>
                                    <span class="position">Interface Designer</span>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="testimony-wrap rounded text-center py-4 pb-5">
                                <div class="user-img mb-2" style="background-image: url(/images/person_3.jpg)">
                                </div>
                                <div class="text pt-4">
                                    <p class="mb-4">Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
                                    <p class="name">Roger Scott</p>
                                    <span class="position">UI Designer</span>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="testimony-wrap rounded text-center py-4 pb-5">
                                <div class="user-img mb-2" style="background-image: url(/images/person_1.jpg)">
                                </div>
                                <div class="text pt-4">
                                    <p class="mb-4">Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
                                    <p class="name">Roger Scott</p>
                                    <span class="position">Web Developer</span>
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="testimony-wrap rounded text-center py-4 pb-5">
                                <div class="user-img mb-2" style="background-image: url(/images/person_1.jpg)">
                                </div>
                                <div class="text pt-4">
                                    <p class="mb-4">Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
                                    <p class="name">Roger Scott</p>
                                    <span class="position">System Analyst</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!--Location-->
    <section class="ftco-section">
        <div class="container">
            <div class="row justify-content-center mb-5">
                <div class="col-md-7 text-center heading-section ftco-animate">
                    <span class="subheading">Location</span>
                    <h2 class="mb-3">Where you want to go?</h2>
                </div>
            </div>
            <div class="row">
                <!-- HA NOI -->
                <div class="col-md-4">
                    <div class="car-wrap rounded ftco-animate">
                        <a href="#" class="img rounded d-flex align-items-end" style="background-image: url('/images/hanoi.jpg');" id="hanoi">
                            <div class="overlay">
                                <div class="text-location">HA NOI</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- HO CHI MINH -->
                <div class="col-md-4">
                    <div class="car-wrap rounded ftco-animate">
                        <a href="#" class="img rounded d-flex align-items-end" style="background-image: url('/images/hochiminhcity.jpg');" id="hochiminh">
                            <div class="overlay">
                                <div class="text-location">HO CHI MINH</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- NHA TRANG -->
                <div class="col-md-4">
                    <div class="car-wrap rounded ftco-animate">
                        <a href="#" class="img rounded d-flex align-items-end" style="background-image: url('/images/nhatrang.jpg');" id="nhatrang">
                            <div class="overlay">
                                <div class="text-location">NHA TRANG</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- QUANG NINH -->
                <div class="col-md-4">
                    <div class="car-wrap rounded ftco-animate">
                        <a href="#" class="img rounded d-flex align-items-end" style="background-image: url('/images/quangninh.jpg');" id="quangninh">
                            <div class="overlay">
                                <div class="text-location">QUANG NINH</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- DA NANG -->
                <div class="col-md-4">
                    <div class="car-wrap rounded ftco-animate">
                        <a href="#" class="img rounded d-flex align-items-end" style="background-image: url('/images/danang.jpg');" id="danang">
                            <div class="overlay">
                                <div class="text-location">DA NANG</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- DA LAT -->
                <div class="col-md-4">
                    <div class="car-wrap rounded ftco-animate">
                        <a href="#" class="img rounded d-flex align-items-end" style="background-image: url('/images/dalat.jpg');" id="dalat">
                            <div class="overlay">
                                <div class="text-location">DA LAT</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


    <script>
        //search vihicle btn
        // Get tomorrow's date in YYYY-MM-DD format
        function getTomorrowDate() {
            let today = new Date();
            let tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1); // Add one day to today
            let day = tomorrow.getDate().toString().padStart(2, '0');
            let month = (tomorrow.getMonth() + 1).toString().padStart(2, '0');
            let year = tomorrow.getFullYear();
            return `${year}-${month}-${day}`;
        }

        // URL-encode the time string
        function encodeTime(time) {
            return encodeURIComponent(time);
        }

        // Set the URL for the button click
        const tomorrowDate = getTomorrowDate();
        const pickTime = encodeTime("00:00"); // 12:00 AM
        const dropTime = encodeTime("12:00"); // 12:00 PM

        document.getElementById("searchVehicleBtn").href =
            `http://localhost:8080/searchCar?name=&pickDate=${tomorrowDate}&pickTime=${pickTime}&dropDate=${tomorrowDate}&dropTime=${dropTime}`;
    </script>


    <script>
        //search with locaiton
        // Get tomorrow's date
        function getTomorrowDate() {
            let today = new Date();
            let tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1); // Add one day to today
            let day = tomorrow.getDate().toString().padStart(2, '0');
            let month = (tomorrow.getMonth() + 1).toString().padStart(2, '0');
            let year = tomorrow.getFullYear();
            return `${year}-${month}-${day}`;
        }

        // URL-encode the time string
        function encodeTime(time) {
            return encodeURIComponent(time);
        }

        // Set the URLs dynamically
        const tomorrowDate = getTomorrowDate();
        const pickTime = encodeTime("00:00");
        const dropTime = encodeTime("12:00");

        document.getElementById("hanoi").href = `http://localhost:8080/searchCar?name=Hà+Nội&pickDate=${tomorrowDate}&pickTime=${pickTime}&dropDate=${tomorrowDate}&dropTime=${dropTime}`;
        document.getElementById("hochiminh").href = `http://localhost:8080/searchCar?name=Hồ+Chí+Minh&pickDate=${tomorrowDate}&pickTime=${pickTime}&dropDate=${tomorrowDate}&dropTime=${dropTime}`;
        document.getElementById("nhatrang").href = `http://localhost:8080/searchCar?name=Nha+Trang&pickDate=${tomorrowDate}&pickTime=${pickTime}&dropDate=${tomorrowDate}&dropTime=${dropTime}`;
        document.getElementById("quangninh").href = `http://localhost:8080/searchCar?name=Quảng+Ninh&pickDate=${tomorrowDate}&pickTime=${pickTime}&dropDate=${tomorrowDate}&dropTime=${dropTime}`;
        document.getElementById("danang").href = `http://localhost:8080/searchCar?name=Đà+Nẵng&pickDate=${tomorrowDate}&pickTime=${pickTime}&dropDate=${tomorrowDate}&dropTime=${dropTime}`;
        document.getElementById("dalat").href = `http://localhost:8080/searchCar?name=Lâm+Đồng&pickDate=${tomorrowDate}&pickTime=${pickTime}&dropDate=${tomorrowDate}&dropTime=${dropTime}`;
    </script>

    <script>

        document.querySelectorAll('.details-btn').forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault();

                const carId = this.closest('.item').getAttribute('data-car-id');
                console.log(carId);
                const url = `/carDetail/${carId}`;

                window.location.href = url;
            });
        });

        //book now btn
        document.querySelectorAll('.book-now-btn').forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault();

                // Lấy carId từ thuộc tính data-car-id của phần tử cha
                const carId = this.closest('.item').getAttribute('data-car-id');

                // Tạo ngày bắt đầu là 00:00 ngày mai
                const now = new Date();
                now.setDate(now.getDate() + 1);  // Ngày mai
                const startDate = new Date(now);
                startDate.setHours(0, 0, 0, 0);  // 00h ngày mai

                // Tạo ngày kết thúc là 24:00 ngày mai
                const endDate = new Date(now);
                endDate.setHours(24, 0, 0, 0);  // 24h ngày mai

                // Chuyển các ngày thành chuỗi đúng định dạng cho URL
                const startDateStr = startDate.toISOString().split('T')[0] + '%20-%2000:00';
                const endDateStr = endDate.toISOString().split('T')[0] + '%20-%2000:00';

                // Xây dựng URL với các tham số
                const url = `/customer/booking-car?CarId=${carId}&startDate=${startDateStr}&endDate=${endDateStr}&address=&beforeNavigate=search`;

                // Chuyển hướng đến URL mới
                window.location.href = url;
            });
        });


        document.querySelector('.request-form').addEventListener('submit', function(event) {
            event.preventDefault();  // Prevent form submission for validation

            // Clear previous error messages
            document.getElementById('pick-location-error').textContent = '';
            document.getElementById('pick-date-error').textContent = '';
            document.getElementById('pick-time-error').textContent = '';
            document.getElementById('drop-date-error').textContent = '';
            document.getElementById('drop-time-error').textContent = '';
            document.getElementById('error-messages').textContent = '';

            // Get field values
            const pickLocation = document.getElementById('pick-location').value.trim();
            const pickDate = document.getElementById('book_pick_dates').value;
            const pickTime = document.getElementById('time_picks').value;
            const dropDate = document.getElementById('book_drop_dates').value;
            const dropTime = document.getElementById('time_drops').value;

            let valid = true;

            // Get current date for comparison
            const today = new Date();
            const currentDate = today.toISOString().split('T')[0];
            const currentTime = today.toTimeString().split(' ')[0].substring(0, 5); // HH:mm format

            // Pick-up location validation


            // Date and Time fields validation
            if (!pickDate) {
                document.getElementById('pick-date-error').textContent = 'Please enter pick-up date';
                valid = false;
            } else if (pickDate < currentDate) {
                document.getElementById('pick-date-error').textContent = 'Pick-up date must not be in the past';
                valid = false;
            }

            if (!pickTime) {
                document.getElementById('pick-time-error').textContent = 'Please enter pick-up time';
                valid = false;
            } else if (pickDate === currentDate && pickTime < currentTime) {
                document.getElementById('pick-time-error').textContent = 'Pick-up time must not be in the past if pick-up date is today';
                valid = false;
            }

            if (!dropDate) {
                document.getElementById('drop-date-error').textContent = 'Please enter drop-off date';
                valid = false;
            } else if (dropDate < currentDate) {
                document.getElementById('drop-date-error').textContent = 'Drop-off date must not be in the past';
                valid = false;
            }

            if (!dropTime) {
                document.getElementById('drop-time-error').textContent = 'Please enter drop-off time';
                valid = false;
            }

            // Validate date and time relationship between pick-up and drop-off
            if (pickDate && pickTime && dropDate && dropTime) {
                const pickDateTime = new Date(`${pickDate}T${pickTime}`);
                const dropDateTime = new Date(`${dropDate}T${dropTime}`);

                if (pickDateTime >= dropDateTime) {
                    document.getElementById('error-messages').textContent = 'Drop-off time must be after pick-up time if on the same day.';
                    valid = false;
                } else if (pickDate === dropDate && pickDateTime.getHours() + 1 > dropDateTime.getHours()) {
                    document.getElementById('error-messages').textContent = 'Drop-off time must be at least 1 hour after pick-up time if on the same day.';
                    valid = false;
                }
            }

            // Submit the form if validation passes
            if (valid) {
                event.target.submit();
            }
        });
    </script>

  </body>
</th:block>
</body>
</html>
