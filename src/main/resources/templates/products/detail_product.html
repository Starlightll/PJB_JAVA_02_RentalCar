<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
>
<head>
  <title>Detail Car</title>
  <meta name="_csrf" th:content="${_csrf.token}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
  <style>
    .hero-wrap {
      height: 200px !important;
      position: relative;
      background-image: url('/images/2024-Skoda-Enyaq-RS-Race-Concept-005-2000.jpg');
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      height: 200px !important;
    }

    .slider-text {
      height: 200px !important;
    }

    /*  Preview part */

    .wrapper {
      position: relative;
      width: 100%;
      height: 400px;
    }

    .wrapper .img {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .wrapper .img img {
      height: 100%;
      width: 100%;
      object-fit: cover;
      clip-path: circle(0% at 0% 100%);
      transition: all 0.7s;
    }

    /* CSS cho dynamic ID */
    [id^="one-"]:checked ~ .img-1 img {
      clip-path: circle(150% at 0% 100%);
    }

    [id^="two-"]:checked ~ .img-1 img,
    [id^="two-"]:checked ~ .img-2 img {
      clip-path: circle(150% at 0% 100%);
    }

    [id^="three-"]:checked ~ .img-1 img,
    [id^="three-"]:checked ~ .img-2 img,
    [id^="three-"]:checked ~ .img-3 img {
      clip-path: circle(150% at 0% 100%);
    }

    [id^="four-"]:checked ~ .img-1 img,
    [id^="four-"]:checked ~ .img-2 img,
    [id^="four-"]:checked ~ .img-3 img,
    [id^="four-"]:checked ~ .img-4 img {
      clip-path: circle(150% at 0% 100%);
    }


    /* Slider controls với ID động */
    .wrapper .sliders {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 99;
      display: flex;
    }

    .wrapper .sliders label {
      border: 2px solid rgb(255, 255, 255);
      width: 13px;
      height: 13px;
      margin: 0 3px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #one:checked ~ .sliders label.one,
    #two:checked ~ .sliders label.two,
    #three:checked ~ .sliders label.three,
    #four:checked ~ .sliders label.four,
    #five:checked ~ .sliders label.five {
      width: 35px;
      border-radius: 14px;
      background: rgb(26, 255, 149);
    }

    /* Khi các nút được chọn, thay đổi kích thước và màu sắc */
    input[id^="one-"]:checked ~ .sliders label[id^="label-one"],
    input[id^="two-"]:checked ~ .sliders label[id^="label-two"],
    input[id^="three-"]:checked ~ .sliders label[id^="label-three"],
    input[id^="four-"]:checked ~ .sliders label[id^="label-four"] {
      width: 35px;
      border-radius: 14px;
      background: rgb(26, 255, 149);
    }

    .sliders label:hover {
      background: rgb(26, 255, 149);
    }

    input[type="radio"] {
      display: none;
    }


    /*Rating star*/

    .rating {
      display: flex;
      align-items: center;
      height: 0;
      margin-bottom: 1.2rem;
      width: 116.05px;
    }

    .rating i {
      font-size: 1.2rem;
    }

    .star {
      color: #00d79d;
      overflow: hidden;
      z-index: 1;
      display: flex;
      flex-flow: row;
      gap: 2px;
      width: 20%;
    }

    .star-base {
      position: absolute;
      color: #3d3d3d;
      overflow: hidden;
      z-index: 0;
      display: flex;
      flex-flow: row;
      gap: 2px;
    }

    .required-label::after {
      content: "*";
      color: red;
      font-size: 1rem;
      position: absolute;
      top: -3px;
      left: 1px
    }

    .validate-msg {
      display: none;
      color: #dc3545;
      font-size: 80%;
      margin-top: 0.25rem;
    }

    td {

      padding: 5px !important;
    }

    .table {
      min-width: 0 !important;
    }

    /*Fit image in bootstrap div*/
    .fit-image {
      width: 100%;
      object-fit: cover;
    }


    .card {
      width: 100%;
    }

    .hero-wrap {
      height: 200px !important;
      position: relative;
      background-image: url('/images/2024-Skoda-Enyaq-RS-Race-Concept-005-2000.jpg');
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      height: 200px !important;
    }

    .slider-text {
      height: 200px !important;
    }

    .drop-area {
      width: 100%;
      height: 200px;
      padding: 30px;
      background: #d1d5d9;
      text-align: center;
      border-radius: 10px;
    }

    .img-view {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      border: dashed 2px #86ffcf;
      background: rgb(229 251 255 / 38%);
      padding: 20px;
      overflow: hidden;
    }

    .document p {
      font-size: 10px;
      margin: 0;
    }

    .document span {
      font-size: 10px;
    }
  </style>
</head>

<body>
<th:block layout:fragment="content">
  <body>

  <!-- Modal -->
  <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ModalTitle">No Title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="ModalBody">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-secondary" id="confirm">Yes</button>
          <button type="button" class="btn btn-secondary" id="notConfirm">No</button>
        </div>
      </div>
    </div>
  </div>

  <section class="hero-wrap hero-wrap js-fullheight" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
      <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
        <div class="col-md-9 ftco-animate">
          <p class="breadcrumbs"><span class="mr-2"><a href="/">Home <i class="ion-ios-arrow-forward"></i></a></span>
          <h1 class="mb-3 bread">Detail Car</h1>
        </div>
      </div>
    </div>
  </section>

  <section class="ftco-section p-0" style="min-height: 500px !important;">
    <div class="container">
      <!-- Modal -->
      <div class="modal fade" id="hasDraftModal" tabindex="-1" role="dialog"
           aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="hasDraftModalTitle">No Title</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="hasDraftModalBody">
              ...
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-secondary" id="carContinues">Yes</button>
              <button type="button" class="btn btn-secondary" id="carAddNew">No</button>
            </div>
          </div>
        </div>
      </div>


    </div>

    <div class="container pb-5">
      <div class="row mt-5">
        <div class="col-md-12">
          <div class="table-wrap">
            <div class="d-flex justify-content-center">
              <div class="card align-items-start display-flex-center align-items-center"
                   style="">
                <div class="card-body text-left w-100">
                  <h5 class="card-title"></h5>
                  <div class="row d-flex justify-content-center">
                    <th:block th:object="${car}">
                      <input type="text" th:value="${car.getCarId()}" th:id="carId" hidden>
                      <div class="col-lg-12 row p-3" style="border-bottom: solid 3px #01d28e">
                        <div class="col-lg-6 col-md-6 d-flex align-items-center">
                          <div class="wrapper" style="max-height: 270px">
                            <input type="radio" name="slide-1" id="one-1" checked>
                            <input type="radio" name="slide-1" id="two-1">
                            <input type="radio" name="slide-1" id="three-1">
                            <input type="radio" name="slide-1" id="four-1">
                            <div class="img img-1">
                              <img th:src="'/'+${car.getFrontImage()}"
                                   style="background: #1a1a1a" alt="">
                            </div>
                            <div class="img img-2">
                              <img th:src="'/'+${car.getBackImage()}"
                                   style="background: #1a1a1a" alt="">
                            </div>
                            <div class="img img-3">
                              <img th:src="'/'+${car.getLeftImage()}"
                                   style="background: #1a1a1a" alt="">
                            </div>
                            <div class="img img-4">
                              <img th:src="'/'+${car.getRightImage()}"
                                   style="background: #1a1a1a" alt="">
                            </div>
                            <div class="sliders">
                              <label for="one-1" id="label-one-1" class="one"></label>
                              <label for="two-1" id="label-two-1" class="two"></label>
                              <label for="three-1" id="label-three-1"
                                     class="three"></label>
                              <label for="four-1" id="label-four-1" class="four"></label>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-md-6 justify-content-center align-items-center">
                          <div class="row justify-content-center align-items-center align-content-center">
                            <h1 class="col-lg-12 col-md-12 col-sm-12 text-center"
                                style="font-size: 2rem" th:text="${car.getCarName()}">
                            </h1>
                            <div class="col-lg-12 row"
                                 style="display: flex; align-items: center">
                              <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                Ratings: </p>
                              <div class="rating">
                                <div class="star"
                                     th:style="'width:' + ${T(java.lang.Math).random() * 100} +'%'">
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                </div>
                                <div class="star-base">
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                  <i class="fa fa-star"></i>
                                </div>
                              </div>
                            </div>
                            <div class="col-lg-12 row"
                                 style="display: flex; align-items: center">
                              <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                No. of rides: </p>
                              <p>0</p>
                            </div>
                            <div class="col-lg-12 row"
                                 style="display: flex; align-items: center">
                              <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                Price: </p>
                              <p th:text="${#numbers.formatDecimal(car.getBasePrice(), 0, 'COMMA', 0, 'POINT')} + 'K/Day'"
                                 id="previewPrice">0k/Day</p>
                            </div>
                            <div class="col-lg-12 row"
                                 style="display: flex; align-items: center">
                              <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                Location: </p>
                              <p class="col-lg-9 col-md-7 col-sm-7 col-8 p-0"
                                 id="previewLocation"
                                 style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                 th:text="${car.getAddress().getProvince()}">No</p>
                            </div>
                            <div class="col-lg-12 mb-3">
                              <div class="input-group input-group-sm">
                                <div class="input-group-prepend">
                                  <label class="input-group-text"
                                         for="province" th:text="${car.getCarStatus().name}" style="color: green"></label>
                                </div>

                              </div>
                              <a class="validate-msg">Invalid</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </th:block>
                  </div>

                </div>
                <div class="card-body text-left w-100">
                  <nav class="mb-3">
                    <div class="nav nav-tabs" id="nav-tab" role="tablist" style="column-gap: 4px">
                      <button class="nav-link active" id="nav-home-tab" data-toggle="tab"
                              data-target="#nav-home" type="button" role="tab"
                              aria-controls="nav-home" aria-selected="true">Basic Information
                      </button>
                      <button class="nav-link" id="nav-profile-tab" data-toggle="tab"
                              data-target="#nav-profile" type="button" role="tab"
                              aria-controls="nav-profile" aria-selected="false">Details
                      </button>
                      <button class="nav-link" id="nav-contact-tab" data-toggle="tab"
                              data-target="#nav-contact" type="button" role="tab"
                              aria-controls="nav-contact" aria-selected="false">Pricing
                      </button>
                    </div>
                  </nav>
                  <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
                         aria-labelledby="nav-home-tab">
                      <div class="row">
                        <div class="col-lg-6 mb-3 ">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >License plate</span>
                            </div>
                            <input type="text" class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   name="licensePlate"
                                   th:value="${car.licensePlate}" readonly>
                          </div>
                          <a class="validate-msg" id="LicensePlateValidate">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend" >
                              <label class="input-group-text "
                                     for="color"
                              >Color</label>
                            </div>
                            <select class="custom-select"
                                    id="color" name="color" disabled>
                              <option value="" th:selected="${car.color == null}">Choose...</option>
                              <option value="Red" th:selected="${car.color == 'Red'}">Red</option>
                              <option value="Green" th:selected="${car.color == 'Green'}">Green</option>
                              <option value="Blue" th:selected="${car.color == 'Blue'}">Blue</option>
                              <option value="Black" th:selected="${car.color == 'Black'}">Black</option>
                              <option value="Grey" th:selected="${car.color == 'Grey'}">Grey</option>
                              <option value="Gold" th:selected="${car.color == 'Gold'}">Gold</option>
                              <option value="Silver" th:selected="${car.color == 'Silver'}">Silver</option>
                            </select>
                          </div>
                          <a class="validate-msg">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend" >
                              <label class="input-group-text "
                                     for="brand">Brand
                                Name</label>
                            </div>
                            <select class="custom-select" id="brand" name="brand" disabled>
                              <option value="">Choose...</option>
                              <th:block th:each="brand : ${brands}">
                                <option th:value="${brand.brandId}"
                                        th:text="${brand.brandName}"
                                        th:selected="${car.brand?.brandId == brand.brandId}"></option>
                              </th:block>
                            </select>
                          </div>
                          <a class="validate-msg">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3 ">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Model</span>
                            </div>
                            <input type="text" class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="model" name="licensePlate" th:value="${car.model}"
                                   readonly>
                          </div>
                          <a class="validate-msg" id="ModelValidate">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3 ">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Production Year</span>
                            </div>
                            <input type="text" class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="productionYear" name="licensePlate"
                                   th:value="${car.productionYear}" readonly>
                          </div>
                          <a class="validate-msg" id="productionYearValidate">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3 ">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >No Seats</span>
                            </div>
                            <input type="text" class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="seat" name="licensePlate" th:value="${car.seat}"
                                   readonly>
                          </div>
                          <a class="validate-msg" id="seatValidate">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3 ">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Transmission</span>
                            </div>
                            <input type="text" class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="transmission" name="licensePlate"
                                   th:value="${car.seat}" readonly>
                          </div>
                          <a class="validate-msg" id="TransmissionValidate">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3 ">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Fuel</span>
                            </div>
                            <input type="text" class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="fuel" name="licensePlate" th:value="${car.seat}"
                                   readonly>
                          </div>
                          <a class="validate-msg" id="fuelValidate">Invalid</a>
                        </div>
                        <div style="width: 100%; overflow: auto">
                          <h5>Documents</h5>
                          <table class="table table-striped col-lg-12">
                            <thead class="thead-dark">
                            <tr>
                              <th scope="col">No</th>
                              <th scope="col">Name</th>
                              <th scope="col">Note</th>
                              <th scope="col">Link</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                              <th scope="row">1</th>
                              <td>Registration</td>
                              <td>Verified</td>
                              <td><a th:href="${registrationUrl}"
                                     download>Registration</a></td>
                            </tr>
                            <tr>
                              <th scope="row">2</th>
                              <td>Certification</td>
                              <td>Verified</td>
                              <td><a th:href="${certificateUrl}"
                                     download>Certification</a></td>
                            </tr>
                            <tr>
                              <th scope="row">3</th>
                              <td>Insurance</td>
                              <td>Verified</td>
                              <td><a th:href="${insuranceUrl}" download>Insurance</a></td>
                            </tr>
                            </tbody>
                          </table>
                        </div>

                      </div>
                    </div>
                    <div class="tab-pane fade" id="nav-profile" role="tabpanel"
                         aria-labelledby="nav-profile-tab">
                      <div class="row">
                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                              <span class="input-group-text">Mileage</span>
                            </div>
                            <input class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="mileage"
                                   th:value="${formattedMileage.replaceAll(',','')}" readonly>
                          </div>
                          <a class="validate-msg" id="mileageValidate">Invalid</a>
                        </div>

                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                              <span class="input-group-text">Fuel consumption</span>
                            </div>
                            <input class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="fuelConsumption"
                                   th:value="${formattedFuelConsumption.replaceAll(',','')}" readonly>
                            <div class="input-group-append">
                              <span class="input-group-text">liter/100km</span>
                            </div>
                          </div>
                          <a class="validate-msg" id="fuelConsumptionValidate">Invalid</a>
                        </div>
                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                              <label class="input-group-text"
                                     for="province">Province</label>
                            </div>
                            <select class="custom-select" id="province"
                                    disabled>
                              <option value="" th:text="${car.getAddress().province}"></option>
                            </select>
                          </div>
                          <a class="validate-msg">Invalid</a>
                        </div>

                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                              <label class="input-group-text"
                                     for="district">District</label>
                            </div>
                            <select class="custom-select" id="district"
                                    disabled>
                              <option value="" th:text="${car.getAddress().district}">Select</option>
                            </select>
                          </div>
                          <a class="validate-msg">Invalid</a>
                        </div>

                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                              <label class="input-group-text"
                                     for="ward">Ward</label>
                            </div>
                            <select class="custom-select" id="ward"
                                    disabled>
                              <option value="" th:text="${car.getAddress().ward}">Select</option>
                            </select>
                          </div>
                          <a class="validate-msg">Invalid</a>
                        </div>

                        <div class="col-lg-6 mb-3">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                              <span class="input-group-text">Home</span>
                            </div>
                            <input type="text" class="form-control"
                                   aria-label="Sizing example input"
                                   aria-describedby="inputGroup-sizing-default"
                                   id="street" th:value="${car.getAddress().getStreet()}" readonly>
                          </div>
                          <a class="validate-msg">Invalid</a>
                        </div>
                        <div style="padding:10px">
                          <div class="row">
                            <th:block th:each="function : ${additionalFunction}">
                              <div class="form-check col-lg-3 col-md-6 col-6">
                                <input class="form-check-input" type="checkbox"
                                       th:value="${function.functionId}"
                                       name="additionalFunction"
                                       th:checked="${car.getAdditionalFunctions() != null && car.additionalFunctions.contains(function)}" disabled>
                                <label class="form-check-label">
                                  <span th:text="${function.functionName}"></span>
                                </label>
                              </div>
                            </th:block>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                      <div>
                        <div class="row">
                          <div class="col-lg-6 mb-3">
                            <div class="input-group input-group-sm">
                              <div class="input-group-prepend">
                                <span class="input-group-text">Base price</span>
                              </div>
                              <input  class="form-control"
                                      aria-label="Sizing example input"
                                      aria-describedby="inputGroup-sizing-default" id="basePrice" th:value="${formattedBasePrice.replaceAll(',','')}" readonly>
                              <div class="input-group-append">
                                <span class="input-group-text">VND/Day</span>
                              </div>
                            </div>
                            <a class="validate-msg" id="basePriceValidate">Invalid</a>
                          </div>

                          <div class="col-lg-6 mb-3">
                            <div class="input-group input-group-sm">
                              <div class="input-group-prepend">
                                <span class="input-group-text">Car price</span>
                              </div>
                              <input  class="form-control"
                                      aria-label="Sizing example input"
                                      aria-describedby="inputGroup-sizing-default" id="carPrice" th:value="${formattedCarPrice.replaceAll(',','')}" readonly>
                              <div class="input-group-append">
                                <span class="input-group-text">VND/Day</span>
                              </div>
                            </div>
                            <a class="validate-msg" id="carPriceValidate">Invalid</a>
                          </div>
                          <div class="col-lg-6 mb-3">
                            <div class="input-group input-group-sm">
                              <div class="input-group-prepend">
                                <span class="input-group-text">Deposit</span>
                              </div>
                              <input  class="form-control"
                                      aria-label="Sizing example input"
                                      aria-describedby="inputGroup-sizing-default" id="deposit" th:value="${formattedDeposit.replaceAll(',','')}" readonly>
                              <div class="input-group-append">
                                <span class="input-group-text">VND</span>
                              </div>
                            </div>
                            <a class="validate-msg" id="depositValidate">Invalid</a>
                          </div>

                        </div>
                      </div>
                      <h5 class="card-title">Term of Use</h5>
                      <div>
                        <div class="row">
                          <div class="col-lg-12 col-md-12 mb-3">
                            <div class="input-group">
                              <div class="input-group-prepend">
                                <div class="input-group-text">
                                  <label class="form-check-label"
                                         style="padding: 0 10px;">
                                    Write here
                                  </label>
                                </div>
                              </div>
                              <input type="text" class="form-control"
                                     aria-label="Text input with checkbox" id="termOfUse" th:value="${car.terms}" readonly>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div>

                  <button class="btn-primary btn" style="width: 100px; margin: 10px 0 10px 0"
                          onclick="">Rent now</button>

                </div>

              </div>

            </div>

          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen">
    <svg class="circular" width="48px" height="48px">
      <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
      <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
              stroke="#F96D00"/>
    </svg>
  </div>


  <script>
    const csrfToken = $('meta[name="_csrf"]').attr('content');



    function updateCar(){
      const mileage = document.getElementById('mileage').value;
      const fuelConsumption = document.getElementById('fuelConsumption').value;
      const province = document.getElementById('province').value +"," + document.getElementById('province').options[document.getElementById('province').selectedIndex].text;
      const district = document.getElementById('district').value +"," + document.getElementById('district').options[document.getElementById('district').selectedIndex].text;
      const ward = document.getElementById('ward').value +"," + document.getElementById('ward').options[document.getElementById('ward').selectedIndex].text;
      const street = document.getElementById('street').value;
      const checkboxes = document.querySelectorAll('input[name="additionalFunction"]:checked');
      const additionalFunction = [];
      checkboxes.forEach((checkbox) => {
        additionalFunction.push(checkbox.value);
      });
      const basePrice = document.getElementById('basePrice').value;
      const deposit = document.getElementById('deposit').value;
      const termOfUse = document.getElementById('termOfUse').value;
      const carPrice = document.getElementById('carPrice').value;
      const carId = document.getElementById('carId').value;
      const carStatus = document.getElementById('carStatus').value;

      const carData = {
        mileage: mileage,
        fuelConsumption: fuelConsumption,
        additionalFunction: additionalFunction.join(','),
        province: province,
        district: district,
        ward: ward,
        home: street,
        basePrice: basePrice,
        deposit: deposit,
        terms: termOfUse,
        carPrice: carPrice,
        description: "",
      };

      const formData = new FormData();
      //Add carId to formData
      formData.append("carId", carId);
      //Add carStatus to formData
      formData.append("carStatus", carStatus);
      // Add the carDraft object as JSON string
      formData.append("carData", JSON.stringify(carData));

      const fileInputs = {
        "frontImage": document.getElementById("input-file4"),
        "backImage": document.getElementById("input-file5"),
        "leftImage": document.getElementById("input-file6"),
        "rightImage": document.getElementById("input-file7")
      };

      // Check if files exist before adding to FormData
      for (const [key, input] of Object.entries(fileInputs)) {
        if (input && input.files && input.files[0]) {
          formData.append(key, input.files[0]);
        } else {
          // If file is not selected, append null or empty file to maintain the structure
          formData.append(key, new Blob([], { type: 'application/octet-stream' }));
        }
      }
      console.log(carData);
      console.log(fileInputs);
      if(!validate()){
        console.warn("Validation failed, try again!.");
        alert("Validation failed");
        return false;
      }else{
        $.ajax({
          url: '/update-car',
          type: 'POST',
          data: formData,
          processData: false,
          contentType: false,
          headers: {
            'X-CSRF-TOKEN': csrfToken
          },
          success: function (response) {
            console.log("Car updated successfully", response);
            Swal.fire({
              title: 'Updated!',
              text: '' +
                      '',
              icon: 'success',
              confirmButtonText: 'OK',
              customClass: {
                confirmButton: 'my-custom-button'
              }
            });
            return true;
          },
          error: function (xhr, status, error) {
            if (xhr.status === 400) {
              // Display the custom error message from the server
              $('#confirmModal').modal('show');
              $('#ModalTitle').text("Format!");
              $('#ModalBody').html(xhr.responseText);
              $('#confirm').text("OK").click(function () {
                $('#confirmModal').modal('hide');
              });
              $('#notConfirm').hide();
            } else {
              console.log("Other Error:", error);
            }
            return false;
          }
        });
      }
    }

    const MAX_FILE_MB = 200;
    const MAX_SIZE_BYTES = MAX_FILE_MB * 1024 * 1024;
    function uploadfile(imageView, inputFile) {
      const file = inputFile.files[0];
      if (file) {
        const validExtensions = ["jpg", "jpeg", "png"];
        const fileExtension = file.name.split('.').pop().toLowerCase();
        if(file.size > MAX_SIZE_BYTES){
          alert("File size must be less than 200MB");
          inputFile.value = ""; // Reset input nếu file không hợp lệ
          return;
        }
        // Kiểm tra phần mở rộng file
        if (!validExtensions.includes(fileExtension)) {
          alert("Chỉ chấp nhận các định dạng file ảnh: .jpg, .jpeg, .png");
          inputFile.value = ""; // Reset input nếu file không hợp lệ
          return;
        }

        const fileReader = new FileReader();
        fileReader.onload = function(e) {
          imageView.style.backgroundImage = `url(${e.target.result})`;
          imageView.style.backgroundSize = "cover";
          imageView.style.backgroundPosition = "center";
          imageView.innerHTML = "";
        };
        fileReader.readAsDataURL(file); // Đọc file dưới dạng URL để hiển thị
      }
    }


    function displayExistingImage(imageView, imageUrl) {
      if (imageUrl) {
        if (imageUrl.match(/\.(jpg|jpeg|png)$/i)) {
          imageView.style.backgroundImage = 'url(/' + imageUrl.replaceAll("\\", "/") + ')';
          imageView.style.backgroundSize = "cover";
          imageView.style.backgroundPosition = "center";
          imageView.innerHTML = "";
        } else {
          imageView.style.backgroundImage = "none";
          imageView.innerHTML = `
                <i class="fa-solid fa-file fa-2x"></i>
                <p>File đã tải lên</p>
            `;
        }
        imageView.style.border = "none";
      }
    }

    function initializeDropArea(index) {
      const dropArea = document.getElementById(`drop-area${index}`);
      const inputFile = document.getElementById(`input-file${index}`);
      const imageView = document.getElementById(`img-view${index}`);

      // Hiển thị ảnh đã có nếu có
      const existingImageUrl = imageView.getAttribute('data-image-url');
      if (existingImageUrl) {
        displayExistingImage(imageView, existingImageUrl);
      }

      // Xử lý sự kiện change của input file
      inputFile.addEventListener("change", function () {
        uploadfile(imageView, inputFile);
      });

      // Xử lý sự kiện dragover
      dropArea.addEventListener("dragover", function (e) {
        e.preventDefault();
        dropArea.style.background = "rgba(0, 0, 0, 0.1)";
      });

      // Xử lý sự kiện dragleave
      dropArea.addEventListener("dragleave", function (e) {
        e.preventDefault();
        if (!dropArea.contains(e.relatedTarget)) {
          dropArea.style.background = "#d1d5d9";
        }
      });

      // Xử lý sự kiện drop
      dropArea.addEventListener("drop", function (e) {
        e.preventDefault();
        dropArea.style.background = "#d1d5d9";

        const files = e.dataTransfer.files;

        if (files.length > 0) {
          const validExtensions = ["jpg", "jpeg", "png"];
          const fileExtension = files[0].name.split('.').pop().toLowerCase();
          if (files[0].size > MAX_SIZE_BYTES) {
            alert("File size must be less than 200MB");
            return;
          }
          // Kiểm tra phần mở rộng file
          if (!validExtensions.includes(fileExtension)) {
            alert("Only accept file type: .jpg, .jpeg, .png");
            return;
          }

          inputFile.files = files; // Thiết lập files cho input
          uploadfile(imageView, inputFile); // Gọi hàm uploadfile
        }
      });
    }

    // Khởi tạo tất cả các vùng upload
    for (let i = 4; i <= 7; i++) {
      initializeDropArea(i);
    }


    //API
    // Call API to fetch provinces, districts and wards
    // Fetch provinces and set default city
    async function fetchProvinces(defaultCity) {
      const response = await fetch('https://provinces.open-api.vn/api/p/');
      const provinces = await response.json();
      const citySelect = document.getElementById('province');

      provinces.forEach(province => {
        const option = document.createElement('option');
        option.value = province.code;
        option.textContent = province.name;
        if (province.code == defaultCity) {
          option.selected = true;
        }
        citySelect.appendChild(option);
      });

      if (defaultCity) {
        fetchDistricts(defaultCity, document.getElementById('district').getAttribute('data-default'));
      }
    }

    // Fetch districts based on selected province and set default value
    async function fetchDistricts(provinceCode, defaultDistrict) {
      const response = await fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`);
      const provinceData = await response.json();
      const districtSelect = document.getElementById('district');

      districtSelect.innerHTML = '<option value="">Select District</option>';
      provinceData.districts.forEach(district => {
        const option = document.createElement('option');
        option.value = district.code;
        option.textContent = district.name;
        if (district.code == defaultDistrict) {
          option.selected = true;
        }
        districtSelect.appendChild(option);
      });

      if (defaultDistrict) {
        fetchWards(defaultDistrict, document.getElementById('ward').getAttribute('data-default'));
      }
    }

    // Fetch wards based on selected district and set default value
    async function fetchWards(districtCode, defaultWard) {
      const response = await fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`);
      const districtData = await response.json();
      const wardSelect = document.getElementById('ward');

      wardSelect.innerHTML = '<option value="">Select Ward</option>';
      districtData.wards.forEach(ward => {
        const option = document.createElement('option');
        option.value = ward.code;
        option.textContent = ward.name;
        if (ward.code == defaultWard) {
          option.selected = true;
        }
        wardSelect.appendChild(option);
      });
    }

    // Event listeners to load data on selection
    document.getElementById('province').addEventListener('change', function () {
      fetchDistricts(this.value);
      document.getElementById('ward').innerHTML = '<option value="">Select Ward</option>'; // Reset ward
      document.getElementById('district').disabled = this.value === ""; // Enable/disable district based on city selection
      document.getElementById('district').value = ""; // Reset district value
      document.getElementById('ward').disabled = true; // Disable ward selection
    });

    document.getElementById('district').addEventListener('change', function () {
      fetchWards(this.value);
      document.getElementById('ward').disabled = this.value === ""; // Enable/disable ward based on district selection
    });


    // Load provinces on page load with default values
    document.addEventListener('DOMContentLoaded', function () {
      const defaultCity = document.getElementById('province').getAttribute('data-default');
      fetchProvinces(defaultCity);
    });


    //Load price
    const basePrice = document.getElementById('basePrice');
    const basePricePreview = document.getElementById('previewPrice');
    basePrice.addEventListener('input', function () {
      const value = parseFloat(basePrice.value) || 0;
      basePricePreview.textContent = new Intl.NumberFormat('en-US').format(value) + ' K/Day';
    });

    const province = document.getElementById('province');
    const district = document.getElementById('district');
    const ward = document.getElementById('district');
    const previewLocation = document.getElementById('previewLocation');
    ward.addEventListener('change', function(){
      previewLocation.textContent = province.options[province.selectedIndex].text + ', ' + district.options[district.selectedIndex].text + ', ' + ward.options[ward.selectedIndex].text;
    });




    function checkDetails(){
      const mileage = document.getElementById('mileage').value;
      const fuelConsumption = document.getElementById('fuelConsumption').value;
      const province = document.getElementById('province').value;
      const district = document.getElementById('district').value;
      const ward = document.getElementById('ward').value;
      const street = document.getElementById('street').value;
      const checkedValues = [];
      const frontImage = document.getElementById("input-file4");
      const backImage = document.getElementById("input-file5");
      const leftImage = document.getElementById("input-file6")
      const rightImage = document.getElementById("input-file7")
      const frontImageUrl = document.getElementById('frontImage').value;
      const backImageUrl = document.getElementById('backImage').value;
      const leftImageUrl = document.getElementById('leftImage').value;
      const rightImageUrl = document.getElementById('rightImage').value;


      console.log(checkedValues);

      if (mileage === ''
              || fuelConsumption === ''
              || province === ''
              || district === ''
              || ward === ''
              || (frontImage.files.length === 0 && frontImageUrl === '')
              || (backImage.files.length === 0 && backImageUrl === '')
              || (leftImage.files.length === 0 && leftImageUrl === '')
              || (rightImage.files.length === 0 && rightImageUrl === '')) {
        alert('Please fill all required fields');
        return false;
      }
      return true;
    }
  </script>
  <script src="/js/update-car-validate.js"></script>
  </body>
</th:block>
</body>
</html>