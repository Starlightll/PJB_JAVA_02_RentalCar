<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
>
<head>
    <title>Edit Booking Details</title>
    <meta name="_csrf" th:content="${_csrf.token}">
    <link rel="stylesheet" href="/webjars/bootstrap-datepicker/1.10.0/dist/css/bootstrap-datepicker3.min.css">
    <link rel="stylesheet" href="/webjars/select2/4.1.0-rc.0/dist/css/select2.css">
    <link rel="stylesheet" href="/webjars/select2-bootstrap4-theme/dist/select2-bootstrap4.min.css">
    <link rel="stylesheet" href="/css/carowner/edit-car.css">
    <link rel="stylesheet" href="/webjars/sweetalert2/11.14.4/dist/sweetalert2.min.css">
    <!-- iziToast CSS -->
    <link rel="stylesheet" href="/webjars/izitoast/1.4.0/dist/css/iziToast.min.css">



    <script src="/webjars/axios/1.6.7/dist/axios.min.js"></script>
    <script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
    <script src="/webjars/select2/4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="/webjars/sweetalert2/11.14.4/dist/sweetalert2.all.min.js"></script>
    <!-- iziToast JavaScript -->
    <script src="/webjars/izitoast/1.4.0/dist/js/iziToast.min.js"></script>

    <style>
        .hero-wrap {
            height: 200px !important;
            position: relative;
            background-image: url('/images/2024-Skoda-Enyaq-RS-Race-Concept-005-2000.jpg');
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            height: 200px !important;
        }

        .slider-text {
            height: 200px !important;
        }

        /*  Preview part */

        .wrapper {
            position: relative;
            width: 100%;
            height: 400px;
        }

        .wrapper .img {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .wrapper .img img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            clip-path: circle(0% at 0% 100%);
            transition: all 0.7s;
        }

        /* CSS cho dynamic ID */
        [id^="one-"]:checked ~ .img-1 img {
            clip-path: circle(150% at 0% 100%);
        }

        [id^="two-"]:checked ~ .img-1 img,
        [id^="two-"]:checked ~ .img-2 img {
            clip-path: circle(150% at 0% 100%);
        }

        [id^="three-"]:checked ~ .img-1 img,
        [id^="three-"]:checked ~ .img-2 img,
        [id^="three-"]:checked ~ .img-3 img {
            clip-path: circle(150% at 0% 100%);
        }

        [id^="four-"]:checked ~ .img-1 img,
        [id^="four-"]:checked ~ .img-2 img,
        [id^="four-"]:checked ~ .img-3 img,
        [id^="four-"]:checked ~ .img-4 img {
            clip-path: circle(150% at 0% 100%);
        }


        /* Slider controls với ID động */
        .wrapper .sliders {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 99;
            display: flex;
        }

        .wrapper .sliders label {
            border: 2px solid rgb(255, 255, 255);
            width: 13px;
            height: 13px;
            margin: 0 3px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #one:checked ~ .sliders label.one,
        #two:checked ~ .sliders label.two,
        #three:checked ~ .sliders label.three,
        #four:checked ~ .sliders label.four,
        #five:checked ~ .sliders label.five {
            width: 35px;
            border-radius: 14px;
            background: rgb(26, 255, 149);
        }

        /* Khi các nút được chọn, thay đổi kích thước và màu sắc */
        input[id^="one-"]:checked ~ .sliders label[id^="label-one"],
        input[id^="two-"]:checked ~ .sliders label[id^="label-two"],
        input[id^="three-"]:checked ~ .sliders label[id^="label-three"],
        input[id^="four-"]:checked ~ .sliders label[id^="label-four"] {
            width: 35px;
            border-radius: 14px;
            background: rgb(26, 255, 149);
        }

        .sliders label:hover {
            background: rgb(26, 255, 149);
        }

        input[type="radio"] {
            display: none;
        }


        /*Rating star*/

        .rating {
            display: flex;
            align-items: center;
            height: 0;
            margin-bottom: 1.2rem;
            width: 116.05px;
        }

        .rating i {
            font-size: 1.2rem;
        }


        #button {
            display:  flex;
            justify-content: center;
            align-items: center;
        }

        .custom-confirm-btn, .custom-cancel-btn {
            width: 100px; /* Make both buttons the same width */
            padding: 10px; /* Add padding for better appearance */
        }

        .custom-confirm-btn {
            background-color: #333; /* Set OK button color to black */
            color: white;
            border: none;
            transition: background-color 0.3s; /* Smooth transition for hover effect */
        }

        .custom-confirm-btn:hover {
            background-color: #01d28e; /* Change OK button to green on hover */
        }

        .custom-file-label {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: inline-block;
            max-width: 100%;
        }

        .checkbox {
            --background: #fff;
            --border: #D1D6EE;
            --border-hover: #BBC1E1;
            --border-active: #BBC1E1;
            --tick: #fff;
            position: relative;
        }




        /*Rating Star*/
        /* Popup container */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .popup-content {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
        }


        /* Heading */
        .popup-content h2 {
            margin-top: 0;
            font-size: 24px;
            color: #333;
        }

        /* Rating stars */
        .star-rating {
            font-size: 30px;
            color: #FFD700;
            margin: 15px 0;
            display: flex;
            justify-content: center;
            gap: 5px;

        }

        .star-rating svg {
            fill: #C0C0C0;
            cursor: pointer;
            transition: fill 0.3s;
            width: 30px;
            height: 30px;
        }

        .star-rating svg:hover,
        .star-rating svg.active {
                fill: #32CD32;
                /*fill: #00d79d;*/
        }

        /* Textarea for review */
        .review-textarea {
            width: 100%;
            height: 80px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            /*resize: none;*/
            font-size: 16px;
            margin-top: 10px;
            box-sizing: border-box;
        }

        /* Buttons */
        .popup-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }

        .popup-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .popup-buttons .skip-btn {
            background-color: #ddd;
            color: #333;
        }

        .popup-buttons .skip-btn:hover {
            background-color: #bbb;
        }

        .popup-buttons .submit-btn {
            background-color: #28a745;
            color: #fff;
        }

        .popup-buttons .submit-btn:hover {
            background-color: #218838;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #previewContainer {
            width: auto;
            aspect-ratio: 2 / 1;
            /*border: 1px solid #ddd;*/
            overflow: hidden;
            /*background-color: #f5f5f5;*/
        }

        #previewImage {
            width: auto;
            height: 100%;
            object-fit: cover;
        }
        .select2{
            flex: 1
        }

        .select2-selection__rendered{
            font-size: 0.875rem;
            overflow: unset;
        }

        .select2-container--bootstrap4 .select2-results__option{
            padding: .30rem .30rem;
            font-size: 0.875rem;
        }

        .scroll-container {
            max-height: 560px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px;
            box-sizing: border-box;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Mặc định ẩn */
            justify-content: center;
            align-items: center;
            z-index: 1000;    overflow: auto; /* Đảm bảo hiển thị tốt nếu nội dung dài */

        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            width: 80%;
            max-width: 2200px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
        }

        #differentInfoCheckbox:checked {
            --b: none;
            background-color: #05d38e !important;
            border: 1px solid #05d38e;
        }

        #differentInfoCheckbox:disabled {
            --b: var(--border-active);
            background-color: #D3D3D3;
            border: 1px solid #A9A9A9;
        }


    </style>
</head>

<body>
<th:block layout:fragment="content">
    <body>


    <!-- Modal -->
    <div id="customModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" id="closeModal">&times;</span>
            <h2>Booking Details</h2>
            <div id="modal-body">
                <!-- Nội dung modal sẽ hiển thị ở đây -->
                <section class="ftco-section p-0" style="min-height: 500px !important;">

                    <div class="container pb-5">
                        <div class="row mt-5">
                            <div class="col-md-12">
                                <div class="table-wrap">
                                    <div class="d-flex justify-content-center">
                                        <div class="card align-items-start display-flex-center align-items-center"
                                             style="">
                                            <div class="card-body text-left w-100">
                                                <h5 class="card-title"></h5>
                                                <div class="row d-flex justify-content-center">
                                                    <!--                                        <th:block th:object="${booking}">-->
                                                    <input type="text"  th:value="${contract.getCarId()}"  hidden>
                                                    <div class="col-lg-12 row p-3" style="border-bottom: solid 3px #01d28e">
                                                        <div class="col-lg-6 col-md-6 justify-content-center align-items-center">
                                                            <h4 class="col-lg-12 col-md-12 col-sm-12 " style="text-align: center; margin: 10px; color: black">
                                                                Time on Contract</h4>

                                                            <div class="row justify-content-center align-items-center align-content-center">
                                                                <h4 class="col-lg-12 col-md-12 col-sm-12" style=""
                                                                    th:text="${contract.getCarname() == null ? 'NULL' : contract.getCarname()}">
                                                                    No Name</h4>
                                                                <div>
                                                                    <span></span>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Booking No: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${contract.getBookingId()}">No</p>
                                                                </div>
                                                                <!-- From Date and To Date Section -->
                                                                <div class="col-lg-12 row mt-2">
                                                                    <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        <label>From Date:</label>
                                                                    </div>
                                                                    <p  th:text="${#temporals.format(contract.getStartDate(), 'dd/MM/yyyy HH:mm')}"></p>
                                                                </div>
                                                                <div class="col-lg-12 row mt-2">
                                                                    <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        <label>To Date:</label>
                                                                    </div>
                                                                    <p th:text="${#temporals.format(contract.getEndDate(), 'dd/MM/yyyy HH:mm')}"></p>

                                                                </div>

                                                                <input type="hidden"
                                                                       th:value="${contract.getBookingId()}">
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Number of days: </p>
                                                                    <p th:text="${contract.getStr_numberOfDays() != null ? contract.getStr_numberOfDays() : 0}"></p>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Base price: </p>
                                                                    <p th:text="${#numbers.formatDecimal(contract.getBasePrice(), 0, 'COMMA', 0, 'POINT')} + ' VND/Day'">0k/Day</p>
                                                                </div>
<!--                                                                <div class="col-lg-12 row"-->
<!--                                                                     style="display: flex; align-items: center">-->
<!--                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">-->
<!--                                                                        Total: </p>-->
<!--                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"-->
<!--                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "-->
<!--                                                                       th:text="${#numbers.formatDecimal(contract.getTotalPrice(), 0, 'COMMA', 0, 'POINT')} + ' VND'">-->
<!--                                                                        No</p>-->
<!--                                                                </div>-->

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Fine LateTime: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       th:style="${contract.getFineLateTime() > 0} ? 'color: red;' : 'color: inherit;'"
                                                                       th:text="${#numbers.formatDecimal(contract.getFineLateTime(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Deposit: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(contract.getDeposit(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Addition payment: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(contract.getTotalMoney(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Return Deposit: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(contract.getReturnDeposit(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Salary Driver: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(contract.getSalaryDriver(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Total: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(contract.getTotalPayment(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Booking status:
                                                                    </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       th:text="${contract.bookingStatus}"
                                                                       th:style="${contract.bookingStatus == 'Completed' ? 'color: #0000FF; font-weight: bold;'
           : contract.bookingStatus == 'Confirmed' ? 'color: #c94b55; font-weight: bold;'
           : contract.bookingStatus == 'In-Progress' ? 'color: #FFA500; font-weight: bold;'
           : (contract.bookingStatus == 'Pending deposit' or contract.bookingStatus == 'Pending payment') ? 'color: #FF0000; font-weight: bold;'
           : contract.bookingStatus == 'Cancelled' ? 'color: #808080; font-weight: bold;'
           : contract.bookingStatus == 'Pending cancel' ? 'color: #000000; font-weight: bold;'
           : 'font-weight: bold;'}">
                                                                    </p>

                                                                </div>


                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6 col-md-6 justify-content-center align-items-center">
                                                            <h4 class="col-lg-12 col-md-12 col-sm-12 " style="text-align: center; margin: 10px; color: black">
                                                                Time on Actual</h4>
                                                            <div class="row justify-content-center align-items-center align-content-center">
                                                                <h4 class="col-lg-12 col-md-12 col-sm-12" style=""
                                                                    th:text="${actual.getCarname() == null ? 'NULL' : actual.getCarname()}">
                                                                    No Name</h4>
                                                                <div>
                                                                    <span></span>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Booking No: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       id="previewBookingNoActual"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${actual.getBookingId()}">No</p>
                                                                </div>
                                                                <!-- From Date and To Date Section -->
                                                                <div class="col-lg-12 row mt-2">
                                                                    <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        <label>From Date:</label>
                                                                    </div>
                                                                    <p id="pickupDateActual" th:text="${#temporals.format(actual.getStartDate(), 'dd/MM/yyyy HH:mm')}"></p>
                                                                </div>
                                                                <div class="col-lg-12 row mt-2">
                                                                    <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        <label>To Date:</label>
                                                                    </div>
                                                                    <p id="returnDateActual" th:text="${#temporals.format(actual.getEndDate(), 'dd/MM/yyyy HH:mm')}"></p>

                                                                </div>

                                                                <div class="col-lg-12 row mt-2"
                                                                     th:if="${actual.bookingStatus == 'Completed' or actual.bookingStatus == 'Pending payment'
                                                                    or actual.bookingStatus == 'Cancelled' or actual.bookingStatus == 'Pending cancel'}">

                                                                    <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        <label>Actual End Date:</label>
                                                                    </div>
                                                                    <p id="actualDateDbActual" th:text="${#temporals.format(actual.getActualEndDate(), 'dd/MM/yyyy HH:mm')}"></p>
                                                                </div>

                                                                <div class="col-lg-12 row mt-2"
                                                                     th:if="${(!(actual.bookingStatus == 'Completed' or actual.bookingStatus == 'Pending payment'
                                                                    or actual.bookingStatus == 'Cancelled' or actual.bookingStatus == 'Pending cancel'))  or (actual.bookingStatus == 'In-Progress'
                                                                    or actual.bookingStatus == 'Pending return')}">

                                                                    <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        <label>Actual End Date:</label>
                                                                    </div>
                                                                    <p  th:text="${#temporals.format(timNow, 'dd/MM/yyyy HH:mm')}"></p>

                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Number of days: </p>
                                                                    <p th:text="${actual.getStr_numberOfDays() != null ? actual.getStr_numberOfDays() : 0}"></p>

                                                                    <p th:if="${actual.getLateTime() != null}"
                                                                       style="color: red; font-style: italic;">
                                                                        (
                                                                        <span th:text="${actual.getLateTime()}"></span>
                                                                        )
                                                                    </p>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Base price: </p>
                                                                    <p th:text="${#numbers.formatDecimal(actual.getBasePrice(), 0, 'COMMA', 0, 'POINT')} + ' VND/Day'"
                                                                       id="previewBasePriceActual">0k/Day</p>
                                                                </div>
<!--                                                                <div class="col-lg-12 row"-->
<!--                                                                     style="display: flex; align-items: center">-->
<!--                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">-->
<!--                                                                        Total: </p>-->
<!--                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"-->
<!--                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "-->
<!--                                                                       th:text="${#numbers.formatDecimal(actual.getTotalPrice(), 0, 'COMMA', 0, 'POINT')} + ' VND'">-->
<!--                                                                        No</p>-->
<!--                                                                </div>-->

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Fine LateTime: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       id="fineLateTimeActual"
                                                                       th:style="${actual.getFineLateTime() > 0} ? 'color: red;' : 'color: inherit;'"
                                                                       th:text="${#numbers.formatDecimal(actual.getFineLateTime(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Deposit: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(actual.getDeposit(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Addition payment: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       id="totalMoneyActual"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(actual.getTotalMoney(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Return Deposit: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       id="returnDepositActual"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(actual.getReturnDeposit(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>

                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Salary Driver: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       id="salaryDriverDisplayActual"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(actual.getSalaryDriver(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Total: </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                       th:text="${#numbers.formatDecimal(actual.getTotalPayment(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                        No</p>
                                                                </div>
                                                                <div class="col-lg-12 row"
                                                                     style="display: flex; align-items: center">
                                                                    <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                        Booking status:
                                                                    </p>
                                                                    <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                       th:text="${actual.bookingStatus == 'Completed' ? 'Completed'
           : #temporals.createNow().isAfter(actual.getEndDate()) ? 'Overdue'
           : actual.bookingStatus}"
                                                                       th:style="${actual.bookingStatus == 'Completed' ? 'color: #0000FF; font-weight: bold;'
           : #temporals.createNow().isAfter(actual.getEndDate()) ? 'color: #FF0000; font-weight: bold;'
           : actual.bookingStatus == 'Confirmed' ? 'color: #c94b55; font-weight: bold;'
           : actual.bookingStatus == 'In-Progress' ? 'color: #FFA500; font-weight: bold;'
           : (actual.bookingStatus == 'Pending deposit' or actual.bookingStatus == 'Pending payment') ? 'color: #FF0000; font-weight: bold;'
           : actual.bookingStatus == 'Cancelled' ? 'color: #808080; font-weight: bold;'
           : actual.bookingStatus == 'Pending cancel' ? 'color: #000000; font-weight: bold;'
           : 'font-weight: bold;'}">
                                                                    </p>

                                                                </div>


                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div th:if="${booking.bookingStatus == 'Completed'}" class="col-lg-6 col-md-6 d-flex justify-content-center mt-1">
                                                        <!-- Nút xuất file Excel -->
                                                        <a th:href="${'/bills/export-pdf?bookingId='+ actual.getBookingId() + '&carId=' +actual.getCarId()+'&userId='+actual.getUserId()}" class="btn btn-success">Export to Pdf</a>
                                                    </div>
                                                </div>


                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>





    <!-- Popup Rating -->
    <div class="popup-overlay" id="ratingPopup">
        <div class="popup-content">
            <h2>Rate your trip</h2>
            <p>Do you enjoy your trip? Please let us know what you think.</p>
            <form id="ratingStarForm" method="post" th:action="@{/homepage-customer/rating-star}" th:object="${feedbackDto}" onsubmit="return validateForm()">

                <input type="hidden" name="bookingId" th:value="${booking.getBookingId()}">
                <input type="hidden" id="ratingValue" name="rating" value="0">

                <!-- Star rating -->
                <div class="star-rating">
                    <svg data-rating="1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FFD700"><path d="M12 .587l3.668 7.429 8.332 1.151-6.064 5.608 1.577 8.225L12 18.896l-7.513 4.104 1.577-8.225L.587 9.167l8.332-1.151z"/></svg>
                    <svg data-rating="2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FFD700"><path d="M12 .587l3.668 7.429 8.332 1.151-6.064 5.608 1.577 8.225L12 18.896l-7.513 4.104 1.577-8.225L.587 9.167l8.332-1.151z"/></svg>
                    <svg data-rating="3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FFD700"><path d="M12 .587l3.668 7.429 8.332 1.151-6.064 5.608 1.577 8.225L12 18.896l-7.513 4.104 1.577-8.225L.587 9.167l8.332-1.151z"/></svg>
                    <svg data-rating="4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FFD700"><path d="M12 .587l3.668 7.429 8.332 1.151-6.064 5.608 1.577 8.225L12 18.896l-7.513 4.104 1.577-8.225L.587 9.167l8.332-1.151z"/></svg>
                    <svg data-rating="5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#FFD700"><path d="M12 .587l3.668 7.429 8.332 1.151-6.064 5.608 1.577 8.225L12 18.896l-7.513 4.104 1.577-8.225L.587 9.167l8.332-1.151z"/></svg>
                </div>

                <!-- Review textarea -->
                <textarea class="review-textarea" id="content" name="content" placeholder="Write your review here..." oninput="validateContent()"></textarea>

                <!-- Buttons -->
                <div class="popup-buttons">
                    <button type="button" class="skip-btn" onclick="closePopup()">Skip</button>
                    <button class="submit-btn" id="sendButton">Send Review</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalTitle">No Title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="ModalBody">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-secondary" id="confirm">Yes</button>
                    <button type="button" class="btn btn-secondary" id="notConfirm">No</button>
                </div>
            </div>
        </div>
    </div>

    <section class="hero-wrap hero-wrap js-fullheight" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
                <div class="col-md-9 ftco-animate">
                    <p class="breadcrumbs"><span class="mr-2"><a href="/">Home <i class="ion-ios-arrow-forward"></i></a></span>

                        <th:block th:if="${navigate == 'mybookings' and isCustomer}">
                            <span class="mr-2">
                                <a href="/customer/my-bookings">MY BOOKINGS <i
                                class="ion-ios-arrow-forward"></i></a>
                            </span>
                        </th:block>
                        <th:block th:if="${navigate == 'mybookings' and !isCustomer}">
                            <span class="mr-2">
                                <a href="/car-owner/my-bookings">MY CARS' BOOKINGS <i
                                class="ion-ios-arrow-forward"></i></a>
                            </span>
                        </th:block>
                        <input type="hidden" th:value="${navigate}" id="navigate">
                        <span>BOOKING DETAILS <i
                                class="ion-ios-arrow-forward"></i>
                        </span>
                    </p>
                    <h1 class="mb-3 bread">Booking Detail</h1>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section p-0" style="min-height: 500px !important;">
        <div class="container">
            <!-- Modal -->
            <div class="modal fade" id="hasDraftModal" tabindex="-1" role="dialog"
                 aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="hasDraftModalTitle">No Title</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="hasDraftModalBody">
                            ...
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-secondary" id="carContinues">Yes</button>
                            <button type="button" class="btn btn-secondary" id="carAddNew">No</button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="container pb-5">
            <div class="row mt-5">
                <div class="col-md-12">
                    <div class="table-wrap">
                        <div class="d-flex justify-content-center">
                            <div class="card align-items-start display-flex-center align-items-center"
                                 style="">
                                <div class="card-body text-left w-100">
                                    <h5 class="card-title"></h5>
                                    <div class="row d-flex justify-content-center">
<!--                                        <th:block th:object="${booking}">-->
                                            <input type="text" id="carId" th:value="${car.getCarId()}"  hidden>
                                            <div class="col-lg-12 row p-3" style="border-bottom: solid 3px #01d28e">
                                                <div class="col-lg-6 col-md-6 d-flex align-items-center">
                                                    <div class="wrapper" style="max-height: 270px">
                                                        <input type="radio" name="slide-1" id="one-1" checked>
                                                        <input type="radio" name="slide-1" id="two-1">
                                                        <input type="radio" name="slide-1" id="three-1">
                                                        <input type="radio" name="slide-1" id="four-1">
                                                        <div class="img img-1">
                                                            <img th:src="'/'+${booking.getFrontImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="img img-2">
                                                            <img th:src="'/'+${booking.getBackImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="img img-3">
                                                            <img th:src="'/'+${booking.getLeftImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="img img-4">
                                                            <img th:src="'/'+${booking.getRightImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="sliders">
                                                            <label for="one-1" id="label-one-1" class="one"></label>
                                                            <label for="two-1" id="label-two-1" class="two"></label>
                                                            <label for="three-1" id="label-three-1"
                                                                   class="three"></label>
                                                            <label for="four-1" id="label-four-1" class="four"></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-6 justify-content-center align-items-center">
                                                    <h4 class="col-lg-12 col-md-12 col-sm-12" style=""
                                                        th:text="${booking.getCarname() == null ? 'NULL' : booking.getCarname()}">
                                                        No Name</h4>
                                                    <div class="scroll-container">
                                                        <div class="row justify-content-center align-items-center align-content-center">

                                                        <div>
                                                            <span></span>
                                                        </div>
                                                            <div class="col-lg-12 row"
                                                                 style="display: flex; align-items: center">
                                                                <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                    Booking No: </p>
                                                                <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                   id="previewBookingNo"
                                                                   style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                   th:text="${booking.getBookingId()}">No</p>
                                                            </div>
                                                        <!-- From Date and To Date Section -->
                                                        <div class="col-lg-12 row mt-2">
                                                            <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                <label>From Date:</label>
                                                            </div>
                                                            <p id="pickupDate" th:text="${#temporals.format(booking.getStartDate(), 'dd/MM/yyyy HH:mm')}"></p>
                                                        </div>
                                                        <div class="col-lg-12 row mt-2">
                                                            <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                <label>To Date:</label>
                                                            </div>
                                                            <p id="returnDate" th:text="${#temporals.format(booking.getEndDate(), 'dd/MM/yyyy HH:mm')}"></p>

                                                        </div>
<!--                                                        In ra actual khi đã hoàn thành và không tự tanăng theo thời gian thực-->
                                                        <div class="col-lg-12 row mt-2"
                                                             th:if="${booking.bookingStatus == 'Completed' or booking.bookingStatus == 'Pending payment'
                                                                    or booking.bookingStatus == 'Cancelled' or booking.bookingStatus == 'Pending cancel'}">

                                                            <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                <label>Actual End Date:</label>
                                                            </div>
                                                            <p id="actualDateDb" th:text="${#temporals.format(booking.getActualEndDate(), 'dd/MM/yyyy HH:mm')}"></p>
                                                        </div>
<!--                                                        Ngược lại-->
                                                        <div class="col-lg-12 row mt-2"
                                                             th:if="${(#temporals.createNow().isAfter(booking.getEndDate()) and !(booking.bookingStatus == 'Completed' or booking.bookingStatus == 'Pending payment'
                                                                    or booking.bookingStatus == 'Cancelled' or booking.bookingStatus == 'Pending cancel'))  or (booking.bookingStatus == 'In-Progress'
                                                                    or booking.bookingStatus == 'Pending return')}">

                                                            <div class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                <label>Actual End Date:</label>
                                                            </div>
                                                            <p id="actualDate" th:text="${#temporals.format(timNow, 'dd/MM/yyyy HH:mm')}"></p>

                                                        </div>
                                                        <input type="hidden" id="bookingId"
                                                               th:value="${booking.getBookingId()}">
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Number of days: </p>
                                                            <p th:text="${booking.getStr_numberOfDays() != null ? booking.getStr_numberOfDays() : 0}"></p>
                                                            <!-- Kiểm tra nếu trễ hạn -->
                                                            <p th:if="${booking.getLateTime() != null}"
                                                               style="color: red; font-style: italic;">
                                                                (
                                                                <span th:text="${booking.getLateTime()}"></span>
                                                                )
                                                            </p>
                                                        </div>
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Base price: </p>
                                                            <p th:text="${#numbers.formatDecimal(booking.getBasePrice(), 0, 'COMMA', 0, 'POINT')} + ' VND/Day'"
                                                               id="previewBasePrice">0k/Day</p>
                                                        </div>
<!--                                                            <div class="col-lg-12 row"-->
<!--                                                                 style="display: flex; align-items: center">-->
<!--                                                                <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">-->
<!--                                                                    Total: </p>-->
<!--                                                                <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"-->
<!--                                                                   id="previewTotalPrice"-->
<!--                                                                   style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "-->
<!--                                                                   th:text="${#numbers.formatDecimal(booking.getTotalPrice(), 0, 'COMMA', 0, 'POINT')} + ' VND'">-->
<!--                                                                    No</p>-->
<!--                                                            </div>-->
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Fine LateTime: </p>
                                                            <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                               id="fineLateTime"
                                                               th:style="${booking.getFineLateTime() > 0} ? 'color: red;' : 'color: inherit;'"
                                                               th:text="${#numbers.formatDecimal(booking.getFineLateTime(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                No</p>
                                                        </div>

                                                            <div class="col-lg-12 row"
                                                                 style="display: flex; align-items: center">
                                                                <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                    Deposit: </p>
                                                                <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                   id="previewDeposit"
                                                                   style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                   th:text="${#numbers.formatDecimal(booking.getDeposit(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                    No</p>
                                                            </div>

                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Addition payment: </p>
                                                            <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                               id="totalMoney"
                                                               style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                               th:text="${#numbers.formatDecimal(booking.getTotalMoney(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                No</p>
                                                        </div>

                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Return Deposit: </p>
                                                            <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                               id="returnDeposit"
                                                               style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                               th:text="${#numbers.formatDecimal(booking.getReturnDeposit(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                No</p>
                                                        </div>

                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Salary Driver: </p>
                                                            <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                               id="salaryDriverDisplay"
                                                               style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                               th:text="${#numbers.formatDecimal(booking.getSalaryDriver(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                No</p>
                                                        </div>

                                                            <div class="col-lg-12 row"
                                                                 style="display: flex; align-items: center">
                                                                <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                    Total: </p>
                                                                <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                                   id="previewTotal"
                                                                   style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                                   th:text="${#numbers.formatDecimal(booking.getTotalPayment(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                                    No</p>
                                                            </div>
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-6 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Booking status:
                                                            </p>
                                                            <p class="col-lg-6 col-md-7 col-sm-7 col-8 p-0"
                                                               th:text="${booking.bookingStatus == 'Completed' ? 'Completed'
           : #temporals.createNow().isAfter(booking.getEndDate()) ? 'Overdue'
           : booking.bookingStatus}"
                                                               th:style="${booking.bookingStatus == 'Completed' ? 'color: #0000FF; font-weight: bold;'
           : #temporals.createNow().isAfter(booking.getEndDate()) ? 'color: #FF0000; font-weight: bold;'
           : booking.bookingStatus == 'Confirmed' ? 'color: #c94b55; font-weight: bold;'
           : booking.bookingStatus == 'In-Progress' ? 'color: #FFA500; font-weight: bold;'
           : (booking.bookingStatus == 'Pending deposit' or booking.bookingStatus == 'Pending payment') ? 'color: #FF0000; font-weight: bold;'
           : booking.bookingStatus == 'Cancelled' ? 'color: #808080; font-weight: bold;'
           : booking.bookingStatus == 'Pending cancel' ? 'color: #000000; font-weight: bold;'
           : 'font-weight: bold;'}">
                                                            </p>

                                                        </div>


                                                    </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-6 d-flex justify-content-center mt-1">

                                                    <!-- View Details button: always visible -->
                                                    <a class="btn btn-primary mr-1 btn-lg w-100 align-content-center" href="javascript:void(0);" id="openModalButton">View
                                                        Details</a>

<!--                                                    btn for customer-->
                                                    <th:block th:if="${isCustomer}">


                                                        <!-- Confirm Deposit button: visible only if status is not In-Progress, Pending Payment, Cancelled, or Completed -->
                                                        <a th:href="'#'" id="confirm-booking-detail-btn"
                                                           style="background: #d5dcd5 !important; color: black !important;"
                                                           th:if="${booking.bookingStatus != 'Pending return' and booking.bookingStatus != 'In-Progress' and booking.bookingStatus !='Pending cancel' and booking.bookingStatus != 'Pending payment' and booking.bookingStatus !='Pending deposit' and booking.bookingStatus != 'Cancelled' and booking.bookingStatus != 'Completed'}"
                                                           class="btn btn-primary ml-1 btn-lg w-100 align-content-center">Confirm
                                                            Pick-up</a>

                                                        <!-- Cancel Booking button: visible only if status is Confirmed or Pending deposit and not in the excluded statuses-->
                                                        <a th:href="'#'" style="background: #e82b46 !important;" id="cancel-booking-btn"
                                                           th:if="${( booking.getBookingStatus() == 'Confirmed' or  booking.getBookingStatus() == 'Pending deposit' or  booking.getBookingStatus() == 'Stopped')
                                                        and  booking.getBookingStatus() != 'Pending payment' and booking.bookingStatus !='Pending cancel' and  booking.getBookingStatus() != 'Cancelled' and  booking.getBookingStatus() != 'Completed' and booking.getBookingStatus() != 'In-Progress'}"
                                                           class="btn btn-primary ml-1 btn-lg w-100 align-content-center" >Cancel Booking</a>
                                                        <!-- Return Car button: visible only if status is In-Progress &ndash;&gt;-->
                                                        <a style="background: #707070 !important;"
                                                           th:if="${booking.bookingStatus == 'In-Progress'}"
                                                           class="btn btn-primary ml-1 btn-lg w-100 align-content-center"
                                                           th:onclick="'returnCarDetail(' + ${booking.bookingId} + ')'">Request Return Car</a>

                                                        <a style="background: #707070 !important;"
                                                           th:if="${booking.bookingStatus == 'Pending payment'}"
                                                           class="btn btn-primary ml-1 btn-lg w-100 align-content-center"
                                                           th:onclick="'confirmPaymentDetail(' + ${booking.bookingId} + ')'">Confirm payment</a>
                                                    </th:block>

<!--                                                    btn for car-owner -->

                                                    <th:block th:if="${!isCustomer}">


                                                        <a th:href="'#'" style="background: #e82b46 !important;"
                                                           th:id="'confirm-deposit-btn-' + ${car.getCarId()}"
                                                           th:if="${car.getCarStatus().getStatusId() == 14}"
                                                           class="btn btn-primary ml-1 btn-lg w-100 align-content-center" >Confirm
                                                            Deposit</a>

                                                        <a th:href="'#'"
                                                           th:if="${car.getCarStatus().getStatusId() == 15}"
                                                           class="btn btn-primary ml-1 btn-lg w-100 align-content-center"
                                                           th:id="'confirm-cancel-btn-' + ${car.getCarId()}"
                                                           th:attr="data-car-id=${car.getCarId()}"
                                                           style="background: #000000 !important;">
                                                            Confirm Cancel</a>
                                                        <a th:href="'#'"
                                                           th:if="${car.getCarStatus().getStatusId() == 16}"
                                                           class="btn btn-primary ml-1 btn-lg w-100 align-content-center"
                                                           th:onclick="'confirmReturn(' + ${car.getCarId()} + ')'"
                                                           style="background: #da1b1b !important;">
                                                            Confirm Return</a>
                                                    </th:block>

                                                </div>


                                            </div>
<!--                                        </th:block>-->
                                    </div>

                                </div>
                                <div class="card-body text-left w-100">
                                    <nav class="mb-3">
                                        <div class="nav nav-tabs" id="nav-tab" role="tablist" style="column-gap: 4px">
                                            <button class="nav-link active" id="nav-home-tab" data-toggle="tab"
                                                    data-target="#nav-home" type="button" role="tab"
                                                    aria-controls="nav-home" aria-selected="true">Booking Information
                                            </button>
                                            <button class="nav-link" id="nav-profile-tab" data-toggle="tab"
                                                    data-target="#nav-profile" type="button" role="tab"
                                                    aria-controls="nav-profile" aria-selected="false">Car Information
                                            </button>
                                            <button class="nav-link" id="nav-contact-tab" data-toggle="tab"
                                                    data-target="#nav-contact" type="button" role="tab"
                                                    aria-controls="nav-contact" aria-selected="false">Payment
                                                Information
                                            </button>
                                        </div>
                                    </nav>
                                    <div class="tab-content" id="nav-tabContent">
                                        <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
                                             aria-labelledby="nav-home-tab">
                                            <div class="row">
                                                <h5 class="col-lg-12" >Renter's Information</h5>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Full Name</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="fullName" oninput="validateFullName()"
                                                               th:attr="readonly=${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}"
                                                               th:value="${rentUser.getFullName()}" name="fullName">
                                                    </div>
                                                    <span id="fullNameError" class="text-danger"></span>
                                                    <a class="validate-msg" id="FullNameValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3">

                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Date Of Birth</span>
                                                        </div>
                                                        <input type="date" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               th:value="${rentUser.getDob()}"
                                                               th:attr="readonly=${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}"
                                                               oninput="validateDate()" id="book_pick_date1">

<!--                                                        <a class="validate-msg" id="dateOfBirthValidate">Invalid</a>-->

                                                    </div>
                                                    <div id="dateError" style="color: red"></div>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">

                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Phone Number</span>
                                                        </div>
                                                        <input type="text" th:value="${rentUser.getPhone()}" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="phone" name="phoneNumber"
                                                               th:attr="readonly=${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}"
                                                               oninput="validatePhone()">
                                                    </div>
                                                    <div id="phoneError" style="color: red"></div>
                                                    <a class="validate-msg" id="phoneNumberValidate">Invalid</a>

                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Email Address</span>
                                                        </div>
                                                        <input type="text" readonly th:value="${rentUser.getEmail()}" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="email" name="emailAddress"
                                                               oninput="validateEmail()">
                                                    </div>
                                                    <div id="emailError" style="color: red"></div>
                                                    <a class="validate-msg" id="emailAddressValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >National ID No:</span>
                                                        </div>
                                                        <input type="text" th:value="${rentUser.getNationalId()}" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="nationalId" name="nationalIDNo"
                                                               th:attr="readonly=${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}"
                                                               oninput="validateNationalId()">
                                                    </div>
                                                    <div id="nationalIdError" style="color: red"></div>
                                                    <a class="validate-msg" id="nationalIDNoValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend" style="max-height: 33.5px;">
                                                            <span class="input-group-text" id="inputGroupFileAddon011" >Driving license</span>
                                                        </div>
                                                        <div class="custom-file">
                                                            <!-- Input file -->
                                                            <input type="file" accept="image/*" class="custom-file-input" id="inputGroupFile011"
                                                                   th:disabled="${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}"
                                                                   aria-describedby="inputGroupFileAddon01" onchange="validateDrivingLicense()">

                                                            <!-- Label hiển thị tên file -->
                                                            <label class="custom-file-label" id="fileName" style="font-size: small !important;">
                                                                <!-- Sử dụng Thymeleaf để hiển thị file từ DB nếu có -->
                                                                <span th:if="${rentUser.getDrivingLicense() != null}" th:text="'Current file: '"></span>
                                                                <span th:if="${rentUser.getDrivingLicense() == null}">Choose file</span>
                                                            </label>

                                                        </div>
                                                    </div>

<!--                                                    &lt;!&ndash; Khung hiển thị ảnh &ndash;&gt;-->
<!--                                                    <div id="previewContainer" style="margin-top: 10px; width: 100%; aspect-ratio: 2 / 1; border: 1px solid #ddd; overflow: hidden; background-color: #f5f5f5;">-->
<!--                                                        <img id="previewImage" th:src="'/'+${rentUser.getDrivingLicense()}"-->
<!--                                                             alt="Image preview"-->
<!--                                                             style="width: 100%; height: 100%; object-fit: cover;">-->
<!--                                                    </div>-->

                                                    <input type="hidden" id="currentDrivingLicense" th:value="${rentUser.getDrivingLicense()}">
                                                    <div id="drivingLicenseError" style="color: red"></div>
                                                    <a class="validate-msg" id="drivingLicenseValidate">Invalid</a>
                                                </div>


<!--                                                <div class="row" style="width: 100%; overflow: auto">-->
                                                    <div class="col-lg-6 mb-3 " style="width: 100%; overflow: auto">
                                                        <h6 >Address</h6>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <label class="input-group-text"
                                                                           for="province">Province</label>
                                                                </div>
                                                                <select class="custom-select" id="province" th:value="${rentUser.getCity()}" th:data-default="${rentUser.getCity()}"
                                                                    th:attr="disabled=${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}">
                                                                    <option value="">Select</option>
                                                                </select>
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <label class="input-group-text"
                                                                           for="district">District</label>
                                                                </div>
                                                                <select class="custom-select" id="district" th:value="${rentUser.getDistrict()}" th:data-default="${rentUser.getDistrict()}"
                                                                    th:attr="disabled=${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}">
                                                                    <option value="">Select</option>
                                                                </select>
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <label class="input-group-text"
                                                                           for="ward">Ward</label>
                                                                </div>
                                                                <select class="custom-select" id="ward" th:value="${rentUser.getWard()}" th:data-default="${rentUser.getWard()}"
                                                                    th:attr="disabled=${!isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}" >
                                                                    <option value="">Select</option>
                                                                </select>
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <span class="input-group-text">Home</span>
                                                                </div>
                                                                <input type="text" class="form-control"
                                                                       aria-label="Sizing example input"
                                                                       aria-describedby="inputGroup-sizing-default"
                                                                       id="street"
                                                                       th:attr="readonly=${ !isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}"
                                                                       th:value="${rentUser.getStreet()}">
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>
                                                    </div>

                                                    <!-- Khung hiển thị ảnh -->
                                                    <div  class="col-lg-6 mb-3 " id="previewContainer">
                                                        <img id="previewImage" th:src="'/'+${rentUser.getDrivingLicense()}"
                                                             alt="Image preview"
                                                             style="width: 100%; height: 100%; object-fit: cover;">
                                                    </div>
                                                </div>

<!--                                            </div>-->




                                            <div>
                                                <h5 class="card-title">Driver's information</h5>
                                                <div class="row">
                                                    <label class="checkbox bounce d-flex pl-3" style="align-items: center;column-gap: 6px;">
                                                        <input type="checkbox" id="differentInfoCheckbox"
                                                               name="additionalFunction" value="true" onclick="toggleDriverInfoFields()"
                                                               th:checked="${booking.getDriverId() != null}"
                                                               th:disabled="${booking.getDriverId() != null}">
                                                        <svg viewBox="0 0 21 21">
                                                            <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
                                                        </svg>
                                                        <span>Different than Renter's information</span>
                                                    </label>
                                                </div>
                                                <div id="driverInfoTable" style="display: none; width: 100%">

                                                    <div class="row">
                                                        <div class="col-lg-6 mb-3 ">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Full Name</span>
                                                                </div>
                                                                <select class="custom-select"  onchange="fetchDriverDetailsAjax()"  id="fullNameDriver" th:data-default="${users}"
                                                                        th:attr="disabled=${ !isCustomer or (booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit')}">
                                                                    <option value="">Select a driver</option>
                                                                    <option th:each="driver : ${users}"
                                                                            th:value="${driver.getUserId()}"
                                                                            th:text="${driver.fullName + ' - ' + driver.phone}"
                                                                            th:attr="value=${driver.getUserId()},
                                                                            selected=${driver.getUserId() == booking.getDriverId()},
                                                                            data-selected-driver=${driver.getUserId() == booking.getDriverId()}"
                                                                          >
                                                                    </option>
                                                                </select>
                                                                <input type="hidden" th:value="${booking.getDriverId()}" id="driverId">
                                                            </div>
                                                            <span id="fullNameErrorDriver" class="text-danger"></span>

                                                        </div>
                                                        <div class="col-lg-6 mb-3">

                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Date Of Birth</span>
                                                                </div>
                                                                <input readonly type="date" class="form-control"
                                                                       aria-label="Sizing example input"
                                                                       aria-describedby="inputGroup-sizing-default"
                                                                       id="book_pick_dateDriver">

                                                                <!--                                                        <a class="validate-msg" id="dateOfBirthValidate">Invalid</a>-->

                                                            </div>
                                                            <div id="dateErrorDriver" style="color: red"></div>
                                                        </div>
                                                        <div class="col-lg-6 mb-3 ">

                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Phone Number</span>
                                                                </div>
                                                                <input readonly type="text"  class="form-control"
                                                                       aria-label="Sizing example input"
                                                                       aria-describedby="inputGroup-sizing-default"
                                                                       id="phoneDriver" name="phoneNumber"
                                                                       >
                                                            </div>
                                                            <div id="phoneErrorDriver" style="color: red"></div>

                                                        </div>
                                                        <div class="col-lg-6 mb-3 ">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Email Address</span>
                                                                </div>
                                                                <input  type="text" readonly  class="form-control"
                                                                       aria-label="Sizing example input"
                                                                       aria-describedby="inputGroup-sizing-default"
                                                                       id="emailDriver" name="emailAddress"
                                                                       >
                                                            </div>
                                                            <div id="emailErrorDriver" style="color: red"></div>

                                                        </div>
                                                        <div class="col-lg-6 mb-3 ">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >National ID No:</span>
                                                                </div>
                                                                <input readonly type="text" class="form-control"
                                                                       aria-label="Sizing example input"
                                                                       aria-describedby="inputGroup-sizing-default"
                                                                       id="nationalIdDriver" name="nationalIDNo"
                                                                      >
                                                            </div>
                                                            <div id="nationalIdErrorDriver" style="color: red"></div>
                                                        </div>

<!--                                                        <div class="col-lg-6 mb-3 ">-->
<!--                                                            <div class="input-group input-group-sm">-->
<!--                                                                <div class="input-group-prepend" style="max-height: 33.5px;">-->
<!--                                                                    <span class="input-group-text" id="inputGroupFileAddonDriver" >Avatar</span>-->
<!--                                                                </div>-->
<!--                                                                <div class="custom-file">-->
<!--                                                                    &lt;!&ndash; Input file &ndash;&gt;-->
<!--                                                                    <input disabled type="file" accept="image/*" class="custom-file-input" id="inputGroupFileDriver">-->

<!--                                                                    &lt;!&ndash; Label hiển thị tên file &ndash;&gt;-->
<!--                                                                    <label class="custom-file-label" id="fileNameDriver" style="font-size: small !important;">-->
<!--                                                                        &lt;!&ndash; Sử dụng Thymeleaf để hiển thị file từ DB nếu có &ndash;&gt;-->
<!--                                                                        <span th:if="${rentUser.getDrivingLicense() != null}" th:text="'Current file: '"></span>-->
<!--                                                                        <span th:if="${rentUser.getDrivingLicense() == null}">Choose file</span>-->
<!--                                                                    </label>-->

<!--                                                                </div>-->
<!--                                                            </div>-->

<!--                                                            <input type="hidden" id="currentDrivingLicenseDriver" th:value="${rentUser.getDrivingLicense()}">-->
<!--                                                            <div id="drivingLicenseErrorDriver" style="color: red"></div>-->

<!--                                                        </div>-->
                                                        <div class="col-lg-6 mb-3 ">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        > Description</span>
                                                                </div>
                                                                <textarea  type="text" readonly  class="form-control"
                                                                           aria-label="Sizing example input"
                                                                           aria-describedby="inputGroup-sizing-default"
                                                                           id="descriptionDriver" name="emailAddress"
                                                                ></textarea>
                                                            </div>
                                                            <div id="descriptionDriverErrorDriver" style="color: red"></div>

                                                        </div>

                                                        <div class="col-lg-6 mb-3 ">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Salary Driver:</span>
                                                                </div>
                                                                <input readonly type="text" class="form-control"
                                                                       aria-label="Sizing example input"
                                                                       aria-describedby="inputGroup-sizing-default"
                                                                       id="salaryDriver" name="salary"
                                                                >
                                                            </div>
                                                            <div  style="width: 100%;  margin-top: 20px; overflow: auto">
                                                                <h6 >Address</h6>

                                                                <div class="col-lg-6 mb-3">
                                                                    <div class="input-group input-group-sm">
                                                                        <div class="input-group-prepend">
                                                                            <label class="input-group-text"
                                                                                   for="province">Province</label>
                                                                        </div>
                                                                        <select disabled class="custom-select" id="provinceDriver" >
                                                                            <option value="">Select</option>
                                                                        </select>
                                                                    </div>
                                                                    <a class="validate-msg">Invalid</a>
                                                                </div>

                                                                <div class="col-lg-6 mb-3">
                                                                    <div class="input-group input-group-sm">
                                                                        <div class="input-group-prepend">
                                                                            <label class="input-group-text"
                                                                                   for="district">District</label>
                                                                        </div>
                                                                        <select disabled class="custom-select" id="districtDriver">
                                                                            <option value="">Select</option>
                                                                        </select>
                                                                    </div>
                                                                    <a class="validate-msg">Invalid</a>
                                                                </div>

                                                                <div class="col-lg-6 mb-3">
                                                                    <div class="input-group input-group-sm">
                                                                        <div class="input-group-prepend">
                                                                            <label class="input-group-text"
                                                                                   for="ward">Ward</label>
                                                                        </div>
                                                                        <select disabled class="custom-select" id="wardDriver" >
                                                                            <option value="">Select</option>
                                                                        </select>
                                                                    </div>
                                                                    <a class="validate-msg">Invalid</a>
                                                                </div>

                                                                <div class="col-lg-6 mb-3">
                                                                    <div class="input-group input-group-sm">
                                                                        <div class="input-group-prepend">
                                                                            <span class="input-group-text">Home</span>
                                                                        </div>
                                                                        <input type="text" class="form-control"
                                                                               aria-label="Sizing example input"
                                                                               aria-describedby="inputGroup-sizing-default"
                                                                               id="streetDriver"
                                                                               readonly>
                                                                    </div>
                                                                    <a class="validate-msg">Invalid</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- Khung hiển thị ảnh -->
                                                        <div  class="col-lg-6 mb-3 " id="previewContainerDriver" style=" width: 100%; aspect-ratio: 2 / 1; ">
                                                            <img id="previewImageDriver" th:src="'/'+${rentUser.getAvatar()}"
                                                                 alt="Image preview"
                                                                 style="width: 100%; height: 100%; object-fit: cover;">
                                                        </div>
                                                        <!--                                                <div class="row" style="width: 100%; overflow: auto">-->

                                                    </div>



                                                </div>

                                            </div>

                                            <th:block th:if="${isCustomer}">
                                            <div id="button">
                                                <button class="btn-primary btn" style="width: 100px; margin: 10px 10px 10px 10px"
                                                        onclick="window.history.back()">Discard
                                                </button>
                                                <button class="btn-primary btn" id="save" style="width: 100px; margin: 10px 10px 10px 10px"
                                                        onclick="checkData()"
                                                        th:if="${booking.getBookingStatus() == 'Confirmed' or booking.getBookingStatus() == 'Pending deposit'}">
                                                    Save
                                                </button>
                                            </div>
                                            </th:block>

                                            <div th:if="${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                 style="color: red; margin-top: 10px;">
                                                This booking cannot be edited as its status is <span th:text="${booking.getBookingStatus()}"></span>.
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="nav-profile" role="tabpanel"
                                             aria-labelledby="nav-home-tab">
                                            <div class="row">
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >License plate</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="licensePlate" name="licensePlate"
                                                               th:value="${car.licensePlate}" readonly>
                                                    </div>
                                                    <a class="validate-msg" id="LicensePlateValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                            <label class="input-group-text "
                                                                   for="color"
                                                            >Color</label>
                                                        </div>
                                                        <select class="custom-select"
                                                                id="color" name="color" disabled>
                                                            <option value="" th:selected="${car.color == null}">
                                                                Choose...
                                                            </option>
                                                            <option value="Red" th:selected="${car.color == 'Red'}">
                                                                Red
                                                            </option>
                                                            <option value="Green" th:selected="${car.color == 'Green'}">
                                                                Green
                                                            </option>
                                                            <option value="Blue" th:selected="${car.color == 'Blue'}">
                                                                Blue
                                                            </option>
                                                            <option value="Black" th:selected="${car.color == 'Black'}">
                                                                Black
                                                            </option>
                                                            <option value="Grey" th:selected="${car.color == 'Grey'}">
                                                                Grey
                                                            </option>
                                                            <option value="Gold" th:selected="${car.color == 'Gold'}">
                                                                Gold
                                                            </option>
                                                            <option value="Silver"
                                                                    th:selected="${car.color == 'Silver'}">Silver
                                                            </option>
                                                        </select>
                                                    </div>
                                                    <a class="validate-msg">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                            <label class="input-group-text "
                                                                   for="brand">Brand
                                                                Name</label>
                                                        </div>
                                                        <select class="custom-select" id="brand" name="brand" disabled>
                                                            <option value="">Choose...</option>
                                                            <th:block th:each="brand : ${brands}">
                                                                <option th:value="${brand.brandId}"
                                                                        th:text="${brand.brandName}"
                                                                        th:selected="${car.brand?.brandId == brand.brandId}"></option>
                                                            </th:block>
                                                        </select>
                                                    </div>
                                                    <a class="validate-msg">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Model</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="model" name="licensePlate" th:value="${car.model}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="ModelValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Production Year</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="productionYear" name="licensePlate"
                                                               th:value="${car.productionYear}" readonly>
                                                    </div>
                                                    <a class="validate-msg" id="productionYearValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >No Seats</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="seat" name="licensePlate" th:value="${car.seat}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="seatValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Transmission</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="transmission" name="licensePlate"
                                                               th:value="${car.transmission}" readonly>
                                                    </div>
                                                    <a class="validate-msg" id="TransmissionValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Fuel</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="fuel" name="licensePlate" th:value="${car.fuelType}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="fuelValidate">Invalid</a>
                                                </div>
                                                <div style="width: 100%; overflow: auto">
                                                    <h5>Documents</h5>
                                                    <table class="table table-striped col-lg-12">
                                                        <thead class="thead-dark">
                                                        <tr>
                                                            <th scope="col">No</th>
                                                            <th scope="col">Name</th>
                                                            <th scope="col">Note</th>
                                                            <th scope="col">Link</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr>
                                                            <th scope="row">1</th>
                                                            <td>Registration</td>
                                                            <td>Verified</td>
                                                            <td><a th:href="${registrationUrl}"
                                                                   download>Registration</a></td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">2</th>
                                                            <td>Certification</td>
                                                            <td>Verified</td>
                                                            <td><a th:href="${certificateUrl}"
                                                                   download>Certification</a></td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">3</th>
                                                            <td>Insurance</td>
                                                            <td>Verified</td>
                                                            <td><a th:href="${insuranceUrl}" download>Insurance</a></td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Mileage</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="mileage" name="mileage" th:value="${car.getMileage()}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="mileageValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Fuel consumption</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="fuelConsumption" name="fuelConsumption" th:value="${car.getFuelConsumption()}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="fuelConsumptionValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Address</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="address" name="address"
                                                               th:value="${car.getAddress().getWard() +', '+ car.getAddress().getDistrict()  +', ' + car.getAddress().getProvince()}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="addressValidate">Invalid</a>
                                                </div>
                                                <div class="input-group col-lg-6" style="min-height: 56px">
                                                    <span class="input-group-text" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">Description</span>
                                                    <textarea readonly class="form-control" id="description" aria-label="With textarea" th:text="${car.getDescription()}" style="font-size: 14px;" placeholder="Description of your vehicle"></textarea>
                                                </div>

                                                <div style="padding: 10px">
                                                    <div class="row pl-4 pr-4">
                                                        <th:block th:each="function : ${additionalFunction}">
                                                            <label class="checkbox bounce col-lg-3 col-md-4 col-6 p-0 d-flex" style="align-items: center;column-gap: 6px;">
                                                                <input type="checkbox"
                                                                       th:value="${function.functionId}"
                                                                       name="additionalFunction"
                                                                       th:checked="${car.getAdditionalFunctions() != null && car.additionalFunctions.contains(function)}" disabled>
                                                                <svg viewBox="0 0 21 21" disabled>
                                                                    <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
                                                                </svg>
                                                                <span th:text="${function.functionName}"></span>
                                                            </label>
                                                        </th:block>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12 col-md-12 mb-3">
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <div class="input-group-text">
                                                                    <label class="form-check-label"
                                                                           style="padding: 0 10px;">
                                                                        Write here
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <input readonly type="text" class="form-control"
                                                                   aria-label="Text input with checkbox" id="termOfUse" th:value="${car.terms}">
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="nav-contact" role="tabpanel"
                                             aria-labelledby="nav-contact-tab">
                                            <div>
                                                <div class="row">

                                                </div>
                                            </div>
                                            <h5 class="card-title">My Wallet</h5>
                                            <div>
                                                <div class="row">
                                                    <div class="col-lg-12 col-md-12 mb-3">
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <div class="input-group-text">
                                                                    <label class="form-check-label"
                                                                           style="padding: 0 10px;">
                                                                        Current balance
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <input readonly type="text" class="form-control"
                                                                   aria-label="Text input with checkbox" id="currentBalance"
                                                                   th:value="${#numbers.formatDecimal(rentUser.getWallet(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                        </div>
                                                    </div>
                                                    <span>Please make sure to have sufficient balance the car.</span>

                                                    <a href="/wallet/my-wallet">My Wallet</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen">
        <svg class="circular" width="48px" height="48px">
            <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
            <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                    stroke="#F96D00"/>
        </svg>
    </div>

    <th:block th:if="${isCustomer}">
        <input type="hidden" id="triggerPopup" name="rating" th:value="${isRating}">
    </th:block>
    <input type="hidden" id="userId" name="rating" th:value="${rentUser.getId()}">


    <script>

        $('#fullNameDriver').select2({
            placeholder: "Select a driver",
            allowClear: true,
            theme: 'bootstrap4',
            fontsize: '10px'
        })
        // Hiển thị modal
        document.getElementById("openModalButton").addEventListener("click", function() {
            document.getElementById("customModal").style.display = "flex";
        });

        // Đóng modal
        document.getElementById("closeModal").addEventListener("click", function() {
            document.getElementById("customModal").style.display = "none";
        });

        // Đóng modal khi bấm ra ngoài
        window.addEventListener("click", function(event) {
            var modal = document.getElementById("customModal");
            if (event.target === modal) {
                modal.style.display = "none";
            }
        });


    </script>


    <script>
        const csrfToken = $('meta[name="_csrf"]').attr('content');


        //confirm deposit btn
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded and parsed");
            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;
            const userId = document.getElementById("userId").value;
            const bookingId = document.getElementById('bookingId').value;

            const confirmDepositBtns = document.querySelectorAll('[id^="confirm-deposit-btn-"]');
            confirmDepositBtns.forEach(btn => {
                btn.addEventListener('click', function (event) {
                    event.preventDefault();

                    Swal.fire({
                        title: 'Please confirm that you have received the deposit for this booking.',
                        icon: 'warning',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        showCancelButton: true,
                        customClass: {
                            confirmButton: 'custom-confirm-btn',
                            cancelButton: 'custom-cancel-btn'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            console.log('User confirmed the deposit for car with ID:', carId);
                            window.location.href = '/confirm-deposit-booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                        } else {
                            console.log('User canceled the action');
                        }
                    });
                });
            });
        });

        //confirm cancel btn
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded and parsed");
            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;
            const userId = document.getElementById("userId").value;
            const bookingId = document.getElementById('bookingId').value;

            const confirmCancelBtns = document.querySelectorAll('[id^="confirm-cancel-btn-"]');
            confirmCancelBtns.forEach(btn => {
                btn.addEventListener('click', function (event) {
                    event.preventDefault();

                    Swal.fire({
                        title: 'Confirm cancel booking and refund deposit to customer!',
                        icon: 'question',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        showCancelButton: true,
                        customClass: {
                            confirmButton: 'custom-confirm-btn',
                            cancelButton: 'custom-cancel-btn'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            console.log('User confirmed the cancel for car with ID:', carId);
                            window.location.href = '/confirm-cancel-booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                        } else {
                            console.log('User canceled the action');
                        }
                    });
                });
            });
        });

        // confirm return btn
        function confirmReturn(carId) {
            console.log("confirmReturn called with carId:", carId); // Kiểm tra xem hàm có được gọi không

            $.ajax({
                url: '/car-owner/check-return',
                type: 'get',
                data: {carId: carId},
                success: function (response) {
                    console.log("Check payment successfully", response);

                    Swal.fire({
                        title: 'Confirm Car Returned!',
                        text: response.message,
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        customClass: {
                            confirmButton: 'my-custom-button'
                        }
                    }).then((result) => {
                        console.log("Swal result:", result);
                        if (result.isConfirmed) {
                            confirmReturnCar(carId);
                            console.log("Calling confirmReturnCar with carId:", carId);
                        }
                    });
                },
                error: function (error) {
                    console.log("Error confirm payment", error);
                    let errorMessage;
                    try {
                        const errorResponse = JSON.parse(error.responseText);
                        errorMessage = errorResponse.message || 'An error occurred.';
                    } catch (e) {
                        errorMessage = 'An unexpected error occurred.';
                    }

                    Swal.fire({
                        title: 'Error!',
                        text: errorMessage,
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }

        function confirmReturnCar(carId) {
            console.log("DOM fully loaded and parsed");
            const navigate = document.getElementById("navigate").value;
            const userId = document.getElementById("userId").value;
            const bookingId = document.getElementById('bookingId').value;
            console.log(carId);
            $.ajax({
                    url: '/car-owner/confirm-return-car',
                    type: 'get',
                    data: {carId: carId},
                    success: function (response) {
                        console.log("Confirm payment car response", response);

                        if (response.status === 'success1') {
                            Swal.fire({
                                title: 'Booking Successfully Completed!',
                                text: response.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.href = '/car-owner/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                            })
                        } else if (response.status === 'success2') {
                            Swal.fire({
                                title: 'Your Wallet Not Enough Money.',
                                text: response.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.href = '/car-owner/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                            })
                        } else if (response.status === 'success3') {
                            Swal.fire({
                                title: 'Confirm Return Car Successfully.',
                                text: response.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.href = '/car-owner/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                            })
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: response.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.href = '/car-owner/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                            });
                        }
                    },
                    error:
                        function (error) {
                            console.log("Error confirming return payment", error);
                            Swal.fire({
                                title: 'Error!',
                                text: 'An error occurred. Please try again.',
                                icon: 'error',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                window.location.href = '/car-owner/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                            });
                        }
                }
            )
            ;
        }


        //cancel button
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded and parsed");

            // Cancel Booking Button Event
            const cancelBookingBtn = document.getElementById('cancel-booking-btn'); // ID của nút Cancel
            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;
            const userId = document.getElementById("userId").value;

            if (cancelBookingBtn) {
                cancelBookingBtn.addEventListener('click', function (event) {
                    event.preventDefault();

                    // Lấy bookingId từ trường ẩn
                    const bookingId = document.getElementById('bookingId').value;

                    // Hiển thị hộp thoại xác nhận
                    Swal.fire({
                        title: 'Are you sure you want to cancel this booking?',
                        icon: 'warning',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        showCancelButton: true,
                        customClass: {
                            confirmButton: 'custom-confirm-btn',
                            cancelButton: 'custom-cancel-btn'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            console.log('User chose to cancel the booking with ID:', bookingId);

                            // Gửi yêu cầu xóa (bạn có thể dùng fetch hoặc window.location)
                            window.location.href = '/cancel-booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId  + '&navigate=' + navigate;
                        } else {
                            console.log('User canceled the booking action');
                        }
                    });
                });
            }
        });

        //Confirm pick-up
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded and parsed");

            // Cancel Booking Button Event
            const cancelBookingBtn = document.getElementById('confirm-booking-detail-btn'); // ID của nút Confirm
            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;
            const userId = document.getElementById("userId").value;

            if (cancelBookingBtn) {
                cancelBookingBtn.addEventListener('click', function (event) {
                    event.preventDefault();

                    // Lấy bookingId từ trường ẩn
                    const bookingId = document.getElementById('bookingId').value;

                    // Hiển thị hộp thoại xác nhận
                    Swal.fire({
                        title: 'Are you sure you want to confirm pick-up booking?',
                        icon: 'warning',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        showCancelButton: true,
                        customClass: {
                            confirmButton: 'custom-confirm-btn',
                            cancelButton: 'custom-cancel-btn'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            console.log('User chose to confirm the pick-up with ID:', bookingId);
                            // Gửi yêu cầu xóa (bạn có thể dùng fetch hoặc window.location)
                            window.location.href = '/confirm-pickup-booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId='+ userId + '&navigate=' + navigate;
                      }
                    });
                });
            }
        });

// confirm Payment
        function confirmPaymentDetail(bookingId) {
            console.log(bookingId);
            $.ajax({
                url: '/check-payment',
                type: 'get',
                data: {bookingId: bookingId},
                success: function (response) {
                    console.log("Payment !!!", response);
                    Swal.fire({
                        title: 'Confirm Payment.',
                        text: response.message,
                        icon: 'question',
                        showCancelButton: true,  // Hiển thị nút "Cancel"
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        customClass: {
                            confirmButton: 'my-custom-button'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            confirmPaymentCarDetail(bookingId);
                        }
                    });
                },
                error: function (error) {
                    console.log("Error returning car", error);
                    Swal.fire({
                        title: 'Error!',
                        text: 'Failed to return the car.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }

        function confirmPaymentCarDetail(bookingId) {

            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;
            const userId = document.getElementById("userId").value;
            console.log(bookingId);
            $.ajax({
                url: '/confirm-payment-car',
                type: 'get',
                data: {bookingId: bookingId},
                success: function (response) {
                    console.log("Confirm return car response", response);

                    if (response.status === 'success1') {
                        Swal.fire({
                            title: 'Booking Successfully Completed.',
                            text: response.message,
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
                        });
                    } else if (response.status === 'success2') {
                        Swal.fire({
                            title: 'Request Payment Completed',
                            text: response.message,
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
                        });
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: response.message,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
                        });
                    }
                },
                error: function (error) {
                    console.log("Error confirming return car", error);
                    Swal.fire({
                        title: 'Error!',
                        text: 'An error occurred. Please try again.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
                    });
                }
            });
        }

        // send Return Request

        function returnCarDetail(bookingId) {
            console.log(bookingId);
            $.ajax({
                url: '/return-car',
                type: 'get',
                data: {bookingId: bookingId},
                success: function (response) {
                    console.log("Return car !!!", response);
                    Swal.fire({
                        title: 'Return Car!',
                        text: response.message,
                        icon: 'question',
                        showCancelButton: true,  // Hiển thị nút "Cancel"
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        customClass: {
                            confirmButton: 'my-custom-button'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Gọi tiếp xác nhận trả xe
                            confirmReturnCarDetail(bookingId);
                        }
                    });
                },
                error: function (error) {
                    console.log("Error returning car", error);
                    Swal.fire({
                        title: 'Error!',
                        text: 'Failed to return the car.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }

        function confirmReturnCarDetail(bookingId) {

            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;
            const userId = document.getElementById("userId").value;
            console.log(bookingId);
            $.ajax({
                url: '/confirm-return-car',
                type: 'get',
                data: {bookingId: bookingId},
                success: function (response) {
                    console.log("Confirm return car response", response);

                    if (response.status === 'success1') {
                        Swal.fire({
                            title: 'Request Return Successfully!',
                            text: response.message,
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            let url = '/customer/booking-detail?bookingId=' + bookingId +
                                '&carId=' + carId +
                                '&userId=' + userId +
                                '&navigate=' + navigate;
                            window.location.href = url;
                        });
                    } else if (response.status === 'success2') {
                        Swal.fire({
                            title: 'Request Payment Completed',
                            text: response.message,
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
                        });
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: response.message,
                            icon: 'error',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
                        });
                    }
                },
                error: function (error) {
                    console.log("Error confirming return car", error);
                    Swal.fire({
                        title: 'Error!',
                        text: 'An error occurred. Please try again.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
                    });
                }
            });
        }

// cũ
//         function returnCarDetail(bookingId) {
//             console.log("aaaa",bookingId);
//             $.ajax({
//                 url: '/return-car',
//                 type: 'get',
//                 data: {bookingId: bookingId},
//                 success: function (response) {
//                     console.log("Return car successfully", response);
//                     Swal.fire({
//                         title: 'Return Car!',
//                         text: response.message,
//                         icon: 'question',
//                         showCancelButton: true,  // Hiển thị nút "Cancel"
//                         confirmButtonText: 'Yes',
//                         cancelButtonText: 'No',
//                         customClass: {
//                             confirmButton: 'my-custom-button'
//                         }
//                     }).then((result) => {
//                         if (result.isConfirmed) {
//                             // Gọi tiếp xác nhận trả xe
//                             confirmReturnCarViewDetail(bookingId);
//                         }
//                     });
//                 },
//                 error: function (error) {
//                     console.log("Error returning car", error);
//                     Swal.fire({
//                         title: 'Error!',
//                         text: 'Failed to return the car.',
//                         icon: 'error',
//                         confirmButtonText: 'OK'
//                     });
//                 }
//             });
//         }
//
//
//         function confirmReturnCarViewDetail(bookingId) {
//             const carId = document.getElementById("carId").value;
//             const navigate = document.getElementById("navigate").value;
//             const userId = document.getElementById("userId").value;
//
//             console.log(bookingId);
//             $.ajax({
//                 url: '/confirm-return-car',
//                 type: 'get',
//                 data: {bookingId: bookingId},
//                 success: function (response) {
//                     console.log("Confirm return car response", response);
//
//                     if (response.status === 'success1') {
//                         Swal.fire({
//                             title: 'Return Car Completed!',
//                             text: response.message,
//                             icon: 'success',
//                             confirmButtonText: 'OK'
//                         }).then(() => {
//
//                             let url = '/customer/booking-detail?bookingId=' + bookingId +
//                                 '&carId=' + carId +
//                                 '&userId=' + userId +
//                                 '&navigate=' + navigate;
//                                 url += '&triggerPopup=true';
//
//                             window.location.href = url;
//                             // window.location.href = '/homepage-customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId +'&navigate='+ navigate;
//
//                         });
//                     } else if (response.status === 'success2') {
//                         Swal.fire({
//                             title: 'Request Payment Completed',
//                             text: response.message,
//                             icon: 'success',
//                             confirmButtonText: 'OK'
//                         }).then(() => {
//                             window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId +'&navigate='+ navigate;
//                         });
//                     } else {
//                         Swal.fire({
//                             title: 'Error!',
//                             text: response.message,
//                             icon: 'error',
//                             confirmButtonText: 'OK'
//                         }).then(() => {
//                             window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId + '&navigate='+ navigate;
//                         });
//                     }
//                 },
//                 error: function (error) {
//                     console.log("Error confirming return car", error);
//                     Swal.fire({
//                         title: 'Error!',
//                         text: 'An error occurred. Please try again.',
//                         icon: 'error',
//                         confirmButtonText: 'OK'
//                     }).then(() => {
//                         window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId + '&navigate='+ navigate;
//                     });
//                 }
//             });
//         }




        //====== Save data ======
        function checkData() {
            if(!checkStep()) {
                return;
            }
            updateBooking();
        }

        function checkStep() {

            //kiểm tra xem có driver nào đc chọn khi ấn tích không
            const checked = document.getElementById("differentInfoCheckbox")?.checked || false;
            // Lấy id của người dùng được chọn (nếu chỉ cho phép chọn một)
            // let selectedUserId = null;
            const selectedDriverId = document.getElementById("fullNameDriver").value;
            // const selectedId = $('#fullNameDriver').val();

            console.log("selectedUserId = " ,selectedDriverId)
            if(checked && !selectedDriverId) {
                alert(`Please fill all required fields`);
                return false;
            }

            const currentDrivingLicense = document.getElementById("currentDrivingLicense").value // Dữ liệu từ DB
            let drivingLicense = document.getElementById("inputGroupFile011").value;
            console.log("currentDrivingLicense:",currentDrivingLicense);

            if(!drivingLicense) {
                drivingLicense = currentDrivingLicense;
            }

            console.log(drivingLicense)

            // Thu thập dữ liệu cho renter
            const formData = {
                // pickUpLocation: document.getElementById("editPickupLocation").value,
                // pickUpDateTime: pickupDateFormatted,
                // returnDateTime: returnDateFormatted,

                carId: document.getElementById("carId").value,
                fullName: document.getElementById("fullName").value,
                bookPickDate: document.getElementById("book_pick_date1").value,
                phone: document.getElementById("phone").value,
                email: document.getElementById("email").value,
                nationalId: document.getElementById("nationalId").value,
                drivingLicense: drivingLicense,
                province: document.getElementById("province").value,
                district: document.getElementById("district").value,
                ward: document.getElementById("ward").value,
                street: document.getElementById("street").value
            };

            console.log(formData);

            // Kiểm tra từng thuộc tính xem có bị trống không
            for (const key in formData) {
                if (formData[key] === '') {
                    console.log(`Trường ${key} đang bị trống.`);
                    // Nếu bạn muốn hiện cảnh báo cho người dùng, bạn có thể thêm dòng sau:
                    alert(`Please fill all required fields`);
                    return false;

                }
            }
            return true;
        }

        function updateBooking() {

                const checked = document.getElementById("differentInfoCheckbox").checked;
                const carId = document.getElementById("carId").value;
                const bookingId = document.getElementById("bookingId").value;
                const fullName = document.getElementById('fullName').value;
                const bookPickDate = document.getElementById('book_pick_date1').value;
                const phone = document.getElementById('phone').value;
                const email = document.getElementById('email').value;
                const nationalId = document.getElementById("nationalId").value;
                const drivingLicense = document.getElementById("inputGroupFile011").value;
                const province =  document.getElementById('province').value
                const district =  document.getElementById('district').value;
                const ward =  document.getElementById('ward').value;
                const street = document.getElementById('street').value;
                const selectedDriverId = document.getElementById("fullNameDriver").value;
                const navigate = document.getElementById("navigate").value;
                const userId = document.getElementById("userId").value;




                const bookingInfor = {
                    // location: pickUpLocation,
                    // pickUpDate: pickUpDateTime,
                    // returnDate: returnDateTime,
                    // deposit: depositValue,
                    // step: actualStep,
                     isCheck: checked,
                    carID: carId,
                    bookingId: bookingId,
                    rentFullName: fullName,
                    rentBookPickDate: bookPickDate,
                    rentPhone: phone,
                    rentMail: email,
                    rentNationalId: nationalId,
                    rentDrivingLicense: drivingLicense,
                    rentProvince: province,
                    rentDistrict: district,
                    rentWard: ward,
                    rentStreet: street,
                    selectedUserId: selectedDriverId,
                };

                console.log(bookingInfor)
                // Tạo FormData
                const formData = new FormData();
                formData.append("bookingInfo", JSON.stringify(bookingInfor));

                const fileInputs = {
                    "drivingLicense": document.getElementById("inputGroupFile011"),
                };

                // Kiểm tra các file và thêm vào FormData
                for (const [key, input] of Object.entries(fileInputs)) {
                    if (input && input.files && input.files[0]) {
                        formData.append(key, input.files[0]);
                    } else {
                        formData.append(key, new Blob([], { type: 'application/octet-stream' }));
                    }
                }

                // Gửi AJAX request
                $.ajax({
                    url: '/update-booking-car',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    headers: {
                        'X-CSRF-TOKEN': csrfToken
                    },
                    success: function (response) {

                        // Lấy thông tin từ Map
                        const message = response.message;

                        if(message === "update successfully.") {
                            Swal.fire({
                                title: 'Booking updated successfully!',
                                // text: 'Booking updated successfully!',
                                icon: 'success',
                                confirmButtonText: 'OK',
                                customClass: {
                                    confirmButton: 'custom-confirm-btn'
                                }
                            }).then(() => {
                                window.location.href = '/customer/booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&userId=' + userId + '&navigate='+ navigate;
                            });
                        }

                        console.log("Booking update successfully", message);
                        return true; // Thành công
                    },
                    error: function (xhr, status, error) {
                        if (xhr.status === 400) {
                            if(xhr.responseText === "Your wallet must be greater than deposit") {

                                const topUpLink = `<a href="/wallet/my-wallet" style="color: blue; text-decoration: underline;">Nạp tiền</a>`;
                                const errorMessage = `Your wallet doesn't have enough money to book a car. ${topUpLink}  to continue.`;

                                $('#error-message').html(errorMessage);
                            }
                            alert(xhr.responseText); // Hiển thị lỗi nếu có
                        } else {
                            console.log("Other Error:", error);
                        }
                        return false; // Thất bại
                    }
                });
        }

        const MAX_FILE_MB = 200;
        const MAX_SIZE_BYTES = MAX_FILE_MB * 1024 * 1024;

        function uploadfile(imageView, inputFile) {
            const file = inputFile.files[0];
            if (file) {
                const validExtensions = ["jpg", "jpeg", "png"];
                const fileExtension = file.name.split('.').pop().toLowerCase();
                if (file.size > MAX_SIZE_BYTES) {
                    alert("File size must be less than 200MB");
                    inputFile.value = ""; // Reset input nếu file không hợp lệ
                    return;
                }
                // Kiểm tra phần mở rộng file
                if (!validExtensions.includes(fileExtension)) {
                    alert("Only accept file type: .jpg, .jpeg, .png");
                    inputFile.value = ""; // Reset input nếu file không hợp lệ
                    return;
                }

                const fileReader = new FileReader();
                fileReader.onload = function (e) {
                    imageView.style.backgroundImage = `url(${e.target.result})`;
                    imageView.style.backgroundSize = "cover";
                    imageView.style.backgroundPosition = "center";
                    imageView.innerHTML = "";
                };
                fileReader.readAsDataURL(file); // Đọc file dưới dạng URL để hiển thị
            }
        }



        // Check if all fields are valid before enabling the "Next" button
        function checkValidations() {
            const saveButton = document.getElementById("save");

            // Collect error messages
            const fullNameError = document.getElementById("fullNameError").textContent;
            const emailError = document.getElementById("emailError").textContent;
            const phoneError1 = document.getElementById("phoneError").textContent;
            const dobError = document.getElementById("dateError").textContent;
            const nationalIdError = document.getElementById("nationalIdError").textContent;
            const fileNameError = document.getElementById("drivingLicenseError").textContent;

            // If all error messages are empty, enable the button; otherwise, disable it
            if (!emailError && !phoneError1 && !dobError && !nationalIdError && !fileNameError && !fullNameError) {
                saveButton.disabled = false;
            } else {
                saveButton.disabled = true;
            }
        }

        function validateFullName() {
            const fullName = document.getElementById("fullName").value.trim();
            const fullNameError = document.getElementById("fullNameError");

            if (fullName === "") {
                fullNameError.textContent = "Full name cannot be empty.";
            } else {
                fullNameError.textContent = "";
            }
            checkValidations();
        }


        // Email Validation
        function validateEmail() {
            const email = document.getElementById("email").value;
            const emailError = document.getElementById("emailError");
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
            if (!emailPattern.test(email)) {
                emailError.textContent = "Please enter a valid email address.";
            } else {
                emailError.textContent = "";
            }
            checkValidations();
        }

        // Phone Validation
        function validatePhone() {
            const phone1 = document.getElementById("phone").value;
            const phoneError1 = document.getElementById("phoneError");
            const phonePattern = /^(0|(\+84))?(3|5|7|8|9)\d{8}$/;
            if (!phonePattern.test(phone1)) {
                phoneError1.textContent = "Invalid phone number format.";
            } else {
                phoneError1.textContent = "";
            }
            checkValidations();
        }


        // Date of Birth Validation with 18+ Age Check
        function validateDate() {
            const dob = document.getElementById("book_pick_date1").value;
            const dobError = document.getElementById("dateError");
            const dobDate = new Date(dob);
            const today = new Date();
            const minAgeDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
            const maxAgeDate = new Date(today.getFullYear() - 80, today.getMonth(), today.getDate());
            if (!dob || dobDate > minAgeDate || dobDate < maxAgeDate) {
                dobError.textContent = "Age must be between 18 and 80 years.";
            } else {
                dobError.textContent = "";
            }
            checkValidations();
        }

        // National ID Validation
        function validateNationalId() {
            const nationalId = document.getElementById("nationalId").value;
            const nationalIdError = document.getElementById("nationalIdError");
            const nationalIdPattern = /^[0-9]{9,}$/;
            if (!nationalIdPattern.test(nationalId)) {
                nationalIdError.textContent = "Please enter a valid national ID.";
            } else {
                nationalIdError.textContent = "";
            }
            checkValidations();
        }

        // Driving License Validation
        function validateDrivingLicense() {
            const fileInput = document.getElementById("inputGroupFile011"); // Input file
            const fileNameDisplay = document.getElementById("fileName"); // Label hiển thị tên file
            const fileErrorDisplay = document.getElementById("drivingLicenseError"); // Vùng hiển thị lỗi
            const file = fileInput.files[0]; // File được chọn
            const validImageTypes = ["image/jpeg", "image/png", "image/gif"];
            const maxFileSize = 200 * 1024 * 1024; // 200MB
            const previewImage = document.getElementById("previewImage"); // Thẻ img để hiển thị ảnh
            const previewContainer = document.getElementById("previewContainer"); // Container ảnh

            // Reset thông báo lỗi, hình ảnh và nhãn hiển thị
            fileErrorDisplay.textContent = "";
            previewImage.src = "";
            previewImage.style.display = "none";
            previewContainer.style.display = "block";
            // Reset thông báo lỗi và nhãn hiển thị

            if (file) {
                // Kiểm tra định dạng file
                if (!validImageTypes.includes(file.type)) {
                    fileNameDisplay.textContent = "Only accept file type: .jpg, .jpeg, .png";
                    fileNameDisplay.style.color = "red";
                    fileInput.value = ""; // Reset input file nếu không hợp lệ
                    fileErrorDisplay.textContent = "Only accept file type: .jpg, .jpeg, .png";
                    previewContainer.style.display = "none";
                } else if (file.size > maxFileSize) {
                    // Kiểm tra kích thước file
                    fileNameDisplay.textContent = "File size exceeds 200MB";
                    fileNameDisplay.style.color = "red";
                    fileInput.value = ""; // Reset input file nếu không hợp lệ
                    fileErrorDisplay.textContent = "File size must not exceed 200MB.";
                    previewContainer.style.display = "none";
                } else {
                    // File hợp lệ
                    fileNameDisplay.textContent = `File selected: ${file.name}`;
                    fileNameDisplay.style.color = "green";
                    fileErrorDisplay.textContent = "";

                    // Hiển thị ảnh xem trước
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewImage.src = e.target.result; // Gán src bằng dữ liệu base64 của ảnh
                        previewImage.style.display = "block"; // Hiển thị ảnh
                        previewImage.style.backgroundSize = "cover";
                        previewImage.style.backgroundPosition = "center";
                    };
                    reader.readAsDataURL(file); // Đọc file dưới dạng DataURL

                }
            } else {
                // Không có file nào được chọn
                fileErrorDisplay.textContent = "Please upload a driving license image.";
                fileNameDisplay.textContent = "Choose file";
                fileNameDisplay.style.color = "";
                previewContainer.style.display = "none";
            }

            // Gọi hàm kiểm tra tổng hợp nếu cần
            checkAllValidations();
        }


        function toggleDriverInfoFields() {
            const checkbox = document.getElementById('differentInfoCheckbox');
            const table = document.getElementById('driverInfoTable');

            // Hiển thị bảng nếu checkbox được chọn hoặc bị vô hiệu hóa (driver đã tồn tại)
            table.style.display = checkbox.checked || checkbox.disabled ? 'block' : 'none';
        }


        // Gọi hàm khi trang tải hoặc quay lại từ bộ nhớ cache
        document.addEventListener('DOMContentLoaded', toggleDriverInfoFields);
        window.addEventListener('pageshow', toggleDriverInfoFields);



        // Call API to fetch provinces, districts and wards
        // Fetch provinces and set default city
        async function fetchProvinces(defaultCity) {
            const response = await fetch('https://provinces.open-api.vn/api/p/');
            const provinces = await response.json();
            const citySelect = document.getElementById('province');

            provinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province.code;
                option.textContent = province.name;
                if (province.code == defaultCity) {
                    option.selected = true;
                }
                citySelect.appendChild(option);
            });

            if (defaultCity) {
                fetchDistricts(defaultCity, document.getElementById('district').getAttribute('data-default'));
            }
        }

        // Fetch districts based on selected province and set default value
        async function fetchDistricts(provinceCode, defaultDistrict) {
            const response = await fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`);
            const provinceData = await response.json();
            const districtSelect = document.getElementById('district');

            districtSelect.innerHTML = '<option value="">Select District</option>';
            provinceData.districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district.code;
                option.textContent = district.name;
                if (district.code == defaultDistrict) {
                    option.selected = true;
                }
                districtSelect.appendChild(option);
            });

            if (defaultDistrict) {
                fetchWards(defaultDistrict, document.getElementById('ward').getAttribute('data-default'));
            }
        }

        // Fetch wards based on selected district and set default value
        async function fetchWards(districtCode, defaultWard) {
            const response = await fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`);
            const districtData = await response.json();
            const wardSelect = document.getElementById('ward');

            wardSelect.innerHTML = '<option value="">Select Ward</option>';
            districtData.wards.forEach(ward => {
                const option = document.createElement('option');
                option.value = ward.code;
                option.textContent = ward.name;
                if (ward.code == defaultWard) {
                    option.selected = true;
                }
                wardSelect.appendChild(option);
            });
        }

        // Select 2 library
        $('#province').on('select2:select', function (e) {
            console.log("Province selected");
            const selectedProvince = $(this).val();
            fetchDistricts(selectedProvince);
            $('#ward').html('<option value="">Select Ward</option>').prop('disabled', true);
            $('#district').val("").prop('disabled', selectedProvince === "");
        });


        // Select 2 library
        $('#district').on('select2:select', function (e) {
            console.log("District selected");
            const selectedDistrict = $(this).val();
            fetchWards(selectedDistrict);
            $('#ward').prop('disabled', selectedDistrict === "");
        });

        // Event listeners to load data on selection
        // document.getElementById('province').addEventListener('change', function () {
        //     fetchDistricts(this.value);
        //     document.getElementById('ward').innerHTML = '<option value="">Select Ward</option>'; // Reset ward
        //     document.getElementById('district').disabled = this.value === ""; // Enable/disable district based on city selection
        //     document.getElementById('district').value = ""; // Reset district value
        //     document.getElementById('ward').disabled = true; // Disable ward selection
        // });
        //
        // document.getElementById('district').addEventListener('change', function () {
        //     fetchWards(this.value);
        //     document.getElementById('ward').disabled = this.value === ""; // Enable/disable ward based on district selection
        // });


        // Load provinces on page load with default values
        document.addEventListener('DOMContentLoaded', function () {
            const defaultCity = document.getElementById('province').getAttribute('data-default');
            fetchProvinces(defaultCity);
        });


        // //Load location
        // const province = document.getElementById('province');
        // const district = document.getElementById('district');
        // const ward = document.getElementById('district');
        // const previewLocation = document.getElementById('previewLocation');
        // ward.addEventListener('change', function(){
        //     previewLocation.textContent = province.options[province.selectedIndex].text + ', ' + district.options[district.selectedIndex].text + ', ' + ward.options[ward.selectedIndex].text;
        // });

        function selectOnlyOne(checkbox) {
            const checkboxes = document.querySelectorAll('input[name="selectRow"]');
            checkboxes.forEach((cb) => {
                if (cb !== checkbox) cb.checked = false;
            });
        }
        function checkDetails(){
            const mileage = document.getElementById('mileage').value;
            const fuelConsumption = document.getElementById('fuelConsumption').value;
            const province = document.getElementById('province').value;
            const district = document.getElementById('district').value;
            const ward = document.getElementById('ward').value;
            const street = document.getElementById('street').value;
            const checkedValues = [];
            const frontImage = document.getElementById("input-file4");
            const backImage = document.getElementById("input-file5");
            const leftImage = document.getElementById("input-file6")
            const rightImage = document.getElementById("input-file7")
            const frontImageUrl = document.getElementById('frontImage').value;
            const backImageUrl = document.getElementById('backImage').value;
            const leftImageUrl = document.getElementById('leftImage').value;
            const rightImageUrl = document.getElementById('rightImage').value;


            console.log(checkedValues);

            if (mileage === ''
                || fuelConsumption === ''
                || province === ''
                || district === ''
                || ward === ''
                || (frontImage.files.length === 0 && frontImageUrl === '')
                || (backImage.files.length === 0 && backImageUrl === '')
                || (leftImage.files.length === 0 && leftImageUrl === '')
                || (rightImage.files.length === 0 && rightImageUrl === '')) {
                alert('Please fill all required fields');
                return false;
            }
            return true;
        }
    </script>

<!--    rating star -->
    <script>
        // Star rating functionality
        const stars = document.querySelectorAll('.star-rating svg');
        const ratingValueInput = document.getElementById('ratingValue');

        stars.forEach(star => {
            star.addEventListener('click', () => {
                stars.forEach(s => s.classList.remove('active'));
                star.classList.add('active');
                const rating = star.getAttribute('data-rating');
                for(let i = 0; i < stars.length; i++) {
                    if (i < star.getAttribute('data-rating')) {
                        stars[i].classList.add('active');
                    }
                }
                ratingValueInput.value = rating;
            });
        });

        // Validate form before submission
        function validateForm() {
            if (!ratingValueInput.value) {
                iziToast.error({
                    title: 'Error',
                    message: 'Please select a star to rate!',
                    position: 'topRight',
                    transitionIn: 'fadeInDown',
                    transitionOut: 'fadeOutUp'
                });
                return false;
            }
            return true;
        }

        // Close popup function
        function closePopup() {
            document.getElementById('ratingPopup').style.display = 'none';
        }

        function validateContent() {
            const content = document.getElementById("content").value;
            const sendButton = document.getElementById("sendButton");

            if (content.length > 1000) {
                iziToast.error({
                    title: 'Error',
                    message: 'Content must not exceed 1000 characters.',
                    position: 'topRight',
                    transitionIn: 'fadeInDown',
                    transitionOut: 'fadeOutUp'
                });
                sendButton.disabled = true;
            } else {
                sendButton.disabled = false;
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const triggerPopup = urlParams.get('triggerPopup');

            if (triggerPopup === 'true') {
                // Gọi hàm mở popup đánh giá
                openRatingPopup();
            }
        });

        //Khi load lại trang
        document.addEventListener('DOMContentLoaded', function () {
            const isRating = document.getElementById('triggerPopup').value;

            // Nếu isRating là "true", hiển thị popup
            if (isRating === 'true') {
                openRatingPopup();
            }
        });

        function openRatingPopup() {
            const popup = document.getElementById('ratingPopup');
            popup.style.display = 'block'; // Hiển thị popup
        }

    </script>

    <script>

        $(document).ready(function () {
            $('#ratingStarForm').on('submit', function (event) {
                event.preventDefault(); // Ngăn form submit

                $.ajax({
                    type: 'POST',
                    url: '/homepage-customer/rating-star',
                    data: $(this).serialize(),
                    success: function (response) {
                        // Xóa thông báo lỗi cũ nếu có
                        $('.error').remove();
                        if (response.success) {
                            iziToast.success({
                                title: 'Success',
                                message: response.success,
                                position: 'topRight',
                                transitionIn: 'fadeInDown',
                                transitionOut: 'fadeOutUp',
                            });
                            window.location.href = "/";
                        }
                    },

                    error: function (xhr) {
                        const errors = xhr.responseJSON;
                        $('.error').remove();
                        $('#success-message').hide();

                        let errorMessage = '';
                        for (const field in errors) {
                            errorMessage += `${errors[field]}<br>`;
                        }

                        iziToast.error({
                            title: 'Error',
                            message: errorMessage,
                            position: 'topRight',
                            transitionIn: 'fadeInDown',
                            transitionOut: 'fadeOutUp',
                        });
                    }
                });
            });
        });


        document.addEventListener("DOMContentLoaded", function () {
            const driverDropdown = document.getElementById("fullNameDriver");
            const selectedOption = driverDropdown.querySelector('option[data-selected-driver="true"]');
        console.log('aaaaa', selectedOption);
            if (selectedOption) {
                // Nếu có option được chọn, gọi hàm fetchDriverDetailsAjax
                fetchDriverDetailsAjax();
            }
        });


    </script>

    <script>
        $('#province, #district , #ward').select2({
            placeholder: "Select a province",
            allowClear: true,
            theme: 'bootstrap4',
            fontsize: '10px'
        })
        $('#district').select2({
            placeholder: "Select a district",
            allowClear: true,
            theme: 'bootstrap4',
            fontsize: '10px'
        })
        $('#ward').select2({
            placeholder: "Select a ward",
            allowClear: true,
            theme: 'bootstrap4',
            fontsize: '10px'
        })
    </script>

    <script src="/webjars/bootstrap-datepicker/1.10.0/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="/js/update-car-validate.js"></script>
    <script src="/js/customer/driver_Information.js"></script>
    <script src="/js/customer/calculate-time.js"></script>
    </body>
</th:block>
</body>
</html>
