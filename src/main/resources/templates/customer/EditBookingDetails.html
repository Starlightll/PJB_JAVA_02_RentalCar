<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
>
<head>
    <title>Edit Booking Details</title>
    <meta name="_csrf" th:content="${_csrf.token}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="/css/carowner/edit-car.css">


    <style>
        .hero-wrap {
            height: 200px !important;
            position: relative;
            background-image: url('/images/2024-Skoda-Enyaq-RS-Race-Concept-005-2000.jpg');
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            height: 200px !important;
        }

        .slider-text {
            height: 200px !important;
        }

        /*  Preview part */

        .wrapper {
            position: relative;
            width: 100%;
            height: 400px;
        }

        .wrapper .img {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .wrapper .img img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            clip-path: circle(0% at 0% 100%);
            transition: all 0.7s;
        }

        /* CSS cho dynamic ID */
        [id^="one-"]:checked ~ .img-1 img {
            clip-path: circle(150% at 0% 100%);
        }

        [id^="two-"]:checked ~ .img-1 img,
        [id^="two-"]:checked ~ .img-2 img {
            clip-path: circle(150% at 0% 100%);
        }

        [id^="three-"]:checked ~ .img-1 img,
        [id^="three-"]:checked ~ .img-2 img,
        [id^="three-"]:checked ~ .img-3 img {
            clip-path: circle(150% at 0% 100%);
        }

        [id^="four-"]:checked ~ .img-1 img,
        [id^="four-"]:checked ~ .img-2 img,
        [id^="four-"]:checked ~ .img-3 img,
        [id^="four-"]:checked ~ .img-4 img {
            clip-path: circle(150% at 0% 100%);
        }


        /* Slider controls với ID động */
        .wrapper .sliders {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 99;
            display: flex;
        }

        .wrapper .sliders label {
            border: 2px solid rgb(255, 255, 255);
            width: 13px;
            height: 13px;
            margin: 0 3px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #one:checked ~ .sliders label.one,
        #two:checked ~ .sliders label.two,
        #three:checked ~ .sliders label.three,
        #four:checked ~ .sliders label.four,
        #five:checked ~ .sliders label.five {
            width: 35px;
            border-radius: 14px;
            background: rgb(26, 255, 149);
        }

        /* Khi các nút được chọn, thay đổi kích thước và màu sắc */
        input[id^="one-"]:checked ~ .sliders label[id^="label-one"],
        input[id^="two-"]:checked ~ .sliders label[id^="label-two"],
        input[id^="three-"]:checked ~ .sliders label[id^="label-three"],
        input[id^="four-"]:checked ~ .sliders label[id^="label-four"] {
            width: 35px;
            border-radius: 14px;
            background: rgb(26, 255, 149);
        }

        .sliders label:hover {
            background: rgb(26, 255, 149);
        }

        input[type="radio"] {
            display: none;
        }


        /*Rating star*/

        .rating {
            display: flex;
            align-items: center;
            height: 0;
            margin-bottom: 1.2rem;
            width: 116.05px;
        }

        .rating i {
            font-size: 1.2rem;
        }


        #button {
            display:  flex;
            justify-content: center;
            align-items: center;
        }

        .custom-confirm-btn, .custom-cancel-btn {
            width: 100px; /* Make both buttons the same width */
            padding: 10px; /* Add padding for better appearance */
        }

        .custom-confirm-btn {
            background-color: #333; /* Set OK button color to black */
            color: white;
            border: none;
            transition: background-color 0.3s; /* Smooth transition for hover effect */
        }

        .custom-confirm-btn:hover {
            background-color: #01d28e; /* Change OK button to green on hover */
        }

        .custom-file-label {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: inline-block;
            max-width: 100%;
        }

        .checkbox {
            --background: #fff;
            --border: #D1D6EE;
            --border-hover: #BBC1E1;
            --border-active: #BBC1E1;
            --tick: #fff;
            position: relative;
        }

    </style>
</head>

<body>
<th:block layout:fragment="content">
    <body>

    <!-- Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalTitle">No Title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="ModalBody">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-secondary" id="confirm">Yes</button>
                    <button type="button" class="btn btn-secondary" id="notConfirm">No</button>
                </div>
            </div>
        </div>
    </div>

    <section class="hero-wrap hero-wrap js-fullheight" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
                <div class="col-md-9 ftco-animate">
                    <p class="breadcrumbs"><span class="mr-2"><a href="/">Home <i class="ion-ios-arrow-forward"></i></a></span>

                        <th:block th:if="${navigate == 'mybookings'}">
                            <span class="mr-2">
                                <a onclick="window.history.back()">MY BOOKINGS <i
                                class="ion-ios-arrow-forward"></i></a>
                            </span>
                        </th:block>
                        <input type="hidden" th:value="${navigate}" id="navigate">
                        <span>BOOKING DETAILS <i
                                class="ion-ios-arrow-forward"></i>
                        </span>
                    </p>
                    <h1 class="mb-3 bread">Booking Detail</h1>
                </div>
            </div>
        </div>
    </section>

    <section class="ftco-section p-0" style="min-height: 500px !important;">
        <div class="container">
            <!-- Modal -->
            <div class="modal fade" id="hasDraftModal" tabindex="-1" role="dialog"
                 aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="hasDraftModalTitle">No Title</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="hasDraftModalBody">
                            ...
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-secondary" id="carContinues">Yes</button>
                            <button type="button" class="btn btn-secondary" id="carAddNew">No</button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="container pb-5">
            <div class="row mt-5">
                <div class="col-md-12">
                    <div class="table-wrap">
                        <div class="d-flex justify-content-center">
                            <div class="card align-items-start display-flex-center align-items-center"
                                 style="">
                                <div class="card-body text-left w-100">
                                    <h5 class="card-title"></h5>
                                    <div class="row d-flex justify-content-center">
<!--                                        <th:block th:object="${booking}">-->
                                            <input type="text" id="carId" th:value="${car.getCarId()}"  hidden>
                                            <div class="col-lg-12 row p-3" style="border-bottom: solid 3px #01d28e">
                                                <div class="col-lg-6 col-md-6 d-flex align-items-center">
                                                    <div class="wrapper" style="max-height: 270px">
                                                        <input type="radio" name="slide-1" id="one-1" checked>
                                                        <input type="radio" name="slide-1" id="two-1">
                                                        <input type="radio" name="slide-1" id="three-1">
                                                        <input type="radio" name="slide-1" id="four-1">
                                                        <div class="img img-1">
                                                            <img th:src="'/'+${booking.getFrontImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="img img-2">
                                                            <img th:src="'/'+${booking.getBackImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="img img-3">
                                                            <img th:src="'/'+${booking.getLeftImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="img img-4">
                                                            <img th:src="'/'+${booking.getRightImage()}"
                                                                 style="background: #1a1a1a" alt="">
                                                        </div>
                                                        <div class="sliders">
                                                            <label for="one-1" id="label-one-1" class="one"></label>
                                                            <label for="two-1" id="label-two-1" class="two"></label>
                                                            <label for="three-1" id="label-three-1"
                                                                   class="three"></label>
                                                            <label for="four-1" id="label-four-1" class="four"></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-6 justify-content-center align-items-center">
                                                    <div class="row justify-content-center align-items-center align-content-center">
                                                        <h4 class="col-lg-12 col-md-12 col-sm-12" style=""
                                                            th:text="${booking.getCarname() == null ? 'NULL' : booking.getCarname()}">
                                                            No Name</h4>

                                                        <div>
                                                            <span></span>
                                                        </div>
                                                        <!-- From Date and To Date Section -->
                                                        <div class="col-lg-12 row mt-2">
                                                            <div class="col-lg-6 col-md-6 col-sm-6">
                                                                <label>From Date:</label>
                                                            </div>
                                                            <p th:text="${#temporals.format(booking.getStartDate(), 'dd/MM/yyyy HH:mm')}"></p>
                                                        </div>
                                                        <div class="col-lg-12 row mt-2">
                                                            <div class="col-lg-6 col-md-6 col-sm-6">
                                                                <label>To Date:</label>
                                                            </div>
                                                            <p th:text="${#temporals.format(booking.getActualEndDate(), 'dd/MM/yyyy HH:mm')}"></p>

                                                        </div>
                                                        <input type="hidden" id="bookingId"
                                                               th:value="${booking.getBookingId()}">
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Number of days: </p>
                                                            <p th:text="${booking.getNumberOfDays()}">0</p>

                                                        </div>
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Base price: </p>
                                                            <p th:text="${#numbers.formatDecimal(booking.getBasePrice(), 0, 'COMMA', 0, 'POINT')} + 'K/Day'"
                                                               id="previewBasePrice">0k/Day</p>
                                                        </div>
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Total: </p>
                                                            <p class="col-lg-9 col-md-7 col-sm-7 col-8 p-0"
                                                               id="previewTotal"
                                                               style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                               th:text="${#numbers.formatDecimal(booking.getTotalPrice(), 0, 'COMMA', 0, 'POINT')}">
                                                                No</p>
                                                        </div>
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Deposit: </p>
                                                            <p class="col-lg-9 col-md-7 col-sm-7 col-8 p-0"
                                                               id="previewDeposit"
                                                               style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                               th:text="${#numbers.formatDecimal(booking.getDeposit(), 0, 'COMMA', 0, 'POINT')}">
                                                                No</p>
                                                        </div>
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Booking No: </p>
                                                            <p class="col-lg-9 col-md-7 col-sm-7 col-8 p-0"
                                                               id="previewBookingNo"
                                                               style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;   '...' "
                                                               th:text="${booking.getBookingId()}">No</p>
                                                        </div>
                                                        <div class="col-lg-12 row"
                                                             style="display: flex; align-items: center">
                                                            <p class="col-lg-3 col-md-5 col-sm-5 col-4 p-0 pr-2">
                                                                Booking status:
                                                            </p>
                                                            <p class="col-lg-9 col-md-7 col-sm-7 col-8 p-0"
                                                               th:text="${booking.bookingStatus}"
                                                               th:style="${booking.bookingStatus == 'Confirmed' ? 'color: #c94b55; font-weight: bold;'
                 : booking.bookingStatus == 'In-Progress' ? 'color: #FFA500; font-weight: bold;'
                 : booking.bookingStatus == 'Completed' ? 'color: #0000FF; font-weight: bold;'
                 : (booking.bookingStatus == 'Pending deposit' or booking.bookingStatus == 'Pending payment') ? 'color: #FF0000; font-weight: bold;'
                 : booking.bookingStatus == 'Cancelled' ? 'color: #808080; font-weight: bold;' : 'font-weight: bold;' }">
                                                            </p>
                                                        </div>


                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-6 d-flex justify-content-center mt-1">
                                                    <!-- View Details button: always visible -->
                                                    <a th:href="'/carDetail/' + ${car.carId}"
                                                       class="btn btn-primary mr-1 btn-lg w-100 align-content-center">View
                                                        Details</a>

                                                    <!-- Confirm Deposit button: visible only if status is not In-Progress, Pending Payment, Cancelled, or Completed -->
                                                    <a th:href="'#'"
                                                       style="background: #d5dcd5 !important; color: black !important;"
                                                       th:if="${booking.bookingStatus != 'In-Progress' and booking.bookingStatus != 'Pending payment' and booking.bookingStatus !='Pending deposit' and booking.bookingStatus != 'Cancelled' and booking.bookingStatus != 'Completed'}"
                                                       class="btn btn-primary ml-1 btn-lg w-100 align-content-center">Confirm
                                                        Pick-up</a>

<!--                                                     Cancel Booking button: visible only if status is Confirmed or Pending deposit and not in the excluded statuses-->
                                                    <a th:href="'#'" style="background: #e82b46 !important;" id="cancel-booking-btn"
                                                       th:if="${( booking.getBookingStatus() == 'Confirmed' or  booking.getBookingStatus() == 'Pending deposit' or  booking.getBookingStatus() == 'Stopped')
                                                        and  booking.getBookingStatus() != 'Pending payment' and  booking.getBookingStatus() != 'Cancelled' and  booking.getBookingStatus() != 'Completed' and booking.getBookingStatus() != 'In-Progress'}"
                                                       class="btn btn-primary ml-1 btn-lg w-100 align-content-center" >Cancel
                                                        Booking</a>


                                                    <!-- Return Car button: visible only if status is In-Progress -->
                                                    <a th:href="'#'" style="background: #707070 !important;"
                                                       th:if="${booking.bookingStatus == 'In-Progress'}"
                                                       class="btn btn-primary ml-1 btn-lg w-100 align-content-center">Return
                                                        Car</a>
                                                </div>


                                            </div>
<!--                                        </th:block>-->
                                    </div>

                                </div>
                                <div class="card-body text-left w-100">
                                    <nav class="mb-3">
                                        <div class="nav nav-tabs" id="nav-tab" role="tablist" style="column-gap: 4px">
                                            <button class="nav-link active" id="nav-home-tab" data-toggle="tab"
                                                    data-target="#nav-home" type="button" role="tab"
                                                    aria-controls="nav-home" aria-selected="true">Booking Information
                                            </button>
                                            <button class="nav-link" id="nav-profile-tab" data-toggle="tab"
                                                    data-target="#nav-profile" type="button" role="tab"
                                                    aria-controls="nav-profile" aria-selected="false">Car Information
                                            </button>
                                            <button class="nav-link" id="nav-contact-tab" data-toggle="tab"
                                                    data-target="#nav-contact" type="button" role="tab"
                                                    aria-controls="nav-contact" aria-selected="false">Payment
                                                Information
                                            </button>
                                        </div>
                                    </nav>
                                    <div class="tab-content" id="nav-tabContent">
                                        <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
                                             aria-labelledby="nav-home-tab">
                                            <div class="row">
                                                <h5 class="col-lg-12" >Renter's Information</h5>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Full Name</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="fullName"
                                                               th:attr="readonly=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                               th:value="${driverDetail.getFullName()}" name="fullName">
                                                    </div>
                                                    <a class="validate-msg" id="FullNameValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 required-label ">

                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Date Of Birth</span>
                                                        </div>
                                                        <input type="date" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               th:value="${driverDetail.getDob()}"
                                                               th:attr="readonly=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                               oninput="validateDate()" id="book_pick_date1">

<!--                                                        <a class="validate-msg" id="dateOfBirthValidate">Invalid</a>-->

                                                    </div>
                                                    <div id="dateError" style="color: red"></div>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">

                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Phone Number</span>
                                                        </div>
                                                        <input type="text" th:value="${driverDetail.getPhone()}" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="phone" name="phoneNumber"
                                                               th:attr="readonly=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                               oninput="validatePhone()">
                                                    </div>
                                                    <div id="phoneError" style="color: red"></div>
                                                    <a class="validate-msg" id="phoneNumberValidate">Invalid</a>

                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Email Address</span>
                                                        </div>
                                                        <input type="text" th:value="${driverDetail.getEmail()}" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="email" name="emailAddress"
                                                               th:attr="readonly=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                               oninput="validateEmail()">
                                                    </div>
                                                    <div id="emailError" style="color: red"></div>
                                                    <a class="validate-msg" id="emailAddressValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >National ID No:</span>
                                                        </div>
                                                        <input type="text" th:value="${driverDetail.getNationalId()}" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="nationalId" name="nationalIDNo"
                                                               th:attr="readonly=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                               oninput="validateNationalId()">
                                                    </div>
                                                    <div id="nationalIdError" style="color: red"></div>
                                                    <a class="validate-msg" id="nationalIDNoValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend" style="max-height: 33.5px;">
                                                            <span class="input-group-text" id="inputGroupFileAddon011" >Driving license</span>
                                                        </div>
                                                        <div class="custom-file">
                                                            <!-- Input file -->
                                                            <input type="file" accept="image/*" class="custom-file-input" id="inputGroupFile011"
                                                                   th:disabled="${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                                   aria-describedby="inputGroupFileAddon01" onchange="validateDrivingLicense()">

                                                            <!-- Label hiển thị tên file -->
                                                            <label class="custom-file-label" id="fileName" style="font-size: small !important;">
                                                                <!-- Sử dụng Thymeleaf để hiển thị file từ DB nếu có -->
                                                                <span th:if="${driverDetail.getDrivingLicense() != null}" th:text="'Current file: ' + ${driverDetail.getDrivingLicense()}"></span>
                                                                <span th:if="${driverDetail.getDrivingLicense() == null}">Choose file</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" id="currentDrivingLicense" th:value="${driverDetail.getDrivingLicense()}">
                                                    <div id="drivingLicenseError" style="color: red"></div>
                                                    <a class="validate-msg" id="drivingLicenseValidate">Invalid</a>
                                                </div>

                                                <div style="width: 100%; overflow: auto">
                                                    <div class="col-lg-6 mb-3 ">
                                                        <h6>Address</h6>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <label class="input-group-text"
                                                                           for="province">Province</label>
                                                                </div>
                                                                <select class="custom-select" id="province" th:value="${driverDetail.getCity()}" th:data-default="${driverDetail.getCity()}"
                                                                    th:attr="disabled=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}">
                                                                    <option value="">Select</option>
                                                                </select>
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <label class="input-group-text"
                                                                           for="district">District</label>
                                                                </div>
                                                                <select class="custom-select" id="district" th:value="${driverDetail.getDistrict()}" th:data-default="${driverDetail.getDistrict()}"
                                                                    th:attr="disabled=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}">
                                                                    <option value="">Select</option>
                                                                </select>
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <label class="input-group-text"
                                                                           for="ward">Ward</label>
                                                                </div>
                                                                <select class="custom-select" id="ward" th:value="${driverDetail.getWard()}" th:data-default="${driverDetail.getWard()}"
                                                                    th:attr="disabled=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}" >
                                                                    <option value="">Select</option>
                                                                </select>
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>

                                                        <div class="col-lg-6 mb-3">
                                                            <div class="input-group input-group-sm">
                                                                <div class="input-group-prepend">
                                                                    <span class="input-group-text">Home</span>
                                                                </div>
                                                                <input type="text" class="form-control"
                                                                       aria-label="Sizing example input"
                                                                       aria-describedby="inputGroup-sizing-default"
                                                                       id="street"
                                                                       th:attr="readonly=${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                                       th:value="${driverDetail.getStreet()}">
                                                            </div>
                                                            <a class="validate-msg">Invalid</a>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <div>
                                                <h5 class="card-title">Driver's information</h5>
                                                <div class="row">
                                                    <label class="checkbox bounce d-flex pl-3" style="align-items: center;column-gap: 6px;">
                                                        <input type="checkbox" id="differentInfoCheckbox"
                                                               name="additionalFunction" value="true" onclick="toggleDriverInfoFields()">
                                                        <svg viewBox="0 0 21 21">
                                                            <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
                                                        </svg>
                                                        <span>Different than Renter's information</span>
                                                    </label>
                                                </div>
                                                <div id="driverInfoTable" style="display: none; width: 100%">
                                                    <div>
                                                        <table class="table table-dark table-hover">
                                                            <thead>
                                                            <tr>
                                                                <!--                                                                            <th scope="col">-->
                                                                <!--                                                                                <input type="checkbox" onclick="toggleSelectAll(this)" /> &lt;!&ndash; Ô checkbox để chọn tất cả &ndash;&gt;-->
                                                                <!--                                                                            </th>-->
                                                                <th></th>

                                                                <th scope="col">Name</th>
                                                                <th scope="col">Date</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr th:each="user : ${users}">
                                                                <th scope="row">
                                                                    <input type="checkbox" th:attr="value=${user.userId}"   name="selectRow"
                                                                           th:disabled="${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                                           th:checked="${user.userId == booking.getDriverId()}" onclick="selectOnlyOne(this)" />
                                                                </th>
                                                                <td th:text="${user.getFullName()}"></td>
                                                                <td th:text="${#temporals.format(user.getDob(), 'dd/MM/yyyy')}"></td>
                                                            </tr>

                                                            <!-- Các hàng khác... -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>
                                            <div id="button">
                                                <button class="btn-primary btn" style="width: 100px; margin: 10px 10px 10px 10px"
                                                        onclick="window.history.back()">Discard
                                                </button>
                                                <button class="btn-primary btn" id="save" style="width: 100px; margin: 10px 10px 10px 10px"
                                                        onclick="checkData()"
                                                        th:if="${booking.getBookingStatus() == 'Confirmed' or booking.getBookingStatus() == 'Pending deposit'}">
                                                    Save
                                                </button>
                                            </div>
                                            <div th:if="${booking.getBookingStatus() != 'Confirmed' and booking.getBookingStatus() != 'Pending deposit'}"
                                                 style="color: red; margin-top: 10px;">
                                                This booking cannot be edited as its status is <span th:text="${booking.getBookingStatus()}"></span>.
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="nav-profile" role="tabpanel"
                                             aria-labelledby="nav-home-tab">
                                            <div class="row">
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >License plate</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="licensePlate" name="licensePlate"
                                                               th:value="${car.licensePlate}" readonly>
                                                    </div>
                                                    <a class="validate-msg" id="LicensePlateValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                            <label class="input-group-text "
                                                                   for="color"
                                                            >Color</label>
                                                        </div>
                                                        <select class="custom-select"
                                                                id="color" name="color" disabled>
                                                            <option value="" th:selected="${car.color == null}">
                                                                Choose...
                                                            </option>
                                                            <option value="Red" th:selected="${car.color == 'Red'}">
                                                                Red
                                                            </option>
                                                            <option value="Green" th:selected="${car.color == 'Green'}">
                                                                Green
                                                            </option>
                                                            <option value="Blue" th:selected="${car.color == 'Blue'}">
                                                                Blue
                                                            </option>
                                                            <option value="Black" th:selected="${car.color == 'Black'}">
                                                                Black
                                                            </option>
                                                            <option value="Grey" th:selected="${car.color == 'Grey'}">
                                                                Grey
                                                            </option>
                                                            <option value="Gold" th:selected="${car.color == 'Gold'}">
                                                                Gold
                                                            </option>
                                                            <option value="Silver"
                                                                    th:selected="${car.color == 'Silver'}">Silver
                                                            </option>
                                                        </select>
                                                    </div>
                                                    <a class="validate-msg">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                            <label class="input-group-text "
                                                                   for="brand">Brand
                                                                Name</label>
                                                        </div>
                                                        <select class="custom-select" id="brand" name="brand" disabled>
                                                            <option value="">Choose...</option>
                                                            <th:block th:each="brand : ${brands}">
                                                                <option th:value="${brand.brandId}"
                                                                        th:text="${brand.brandName}"
                                                                        th:selected="${car.brand?.brandId == brand.brandId}"></option>
                                                            </th:block>
                                                        </select>
                                                    </div>
                                                    <a class="validate-msg">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Model</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="model" name="licensePlate" th:value="${car.model}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="ModelValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Production Year</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="productionYear" name="licensePlate"
                                                               th:value="${car.productionYear}" readonly>
                                                    </div>
                                                    <a class="validate-msg" id="productionYearValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >No Seats</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="seat" name="licensePlate" th:value="${car.seat}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="seatValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Transmission</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="transmission" name="licensePlate"
                                                               th:value="${car.transmission}" readonly>
                                                    </div>
                                                    <a class="validate-msg" id="TransmissionValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Fuel</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="fuel" name="licensePlate" th:value="${car.fuelType}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="fuelValidate">Invalid</a>
                                                </div>
                                                <div style="width: 100%; overflow: auto">
                                                    <h5>Documents</h5>
                                                    <table class="table table-striped col-lg-12">
                                                        <thead class="thead-dark">
                                                        <tr>
                                                            <th scope="col">No</th>
                                                            <th scope="col">Name</th>
                                                            <th scope="col">Note</th>
                                                            <th scope="col">Link</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr>
                                                            <th scope="row">1</th>
                                                            <td>Registration</td>
                                                            <td>Verified</td>
                                                            <td><a th:href="${registrationUrl}"
                                                                   download>Registration</a></td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">2</th>
                                                            <td>Certification</td>
                                                            <td>Verified</td>
                                                            <td><a th:href="${certificateUrl}"
                                                                   download>Certification</a></td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row">3</th>
                                                            <td>Insurance</td>
                                                            <td>Verified</td>
                                                            <td><a th:href="${insuranceUrl}" download>Insurance</a></td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Mileage</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="mileage" name="mileage" th:value="${car.model}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="mileageValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Fuel consumption</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="fuelConsumption" name="fuelConsumption" th:value="${car.model}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="fuelConsumptionValidate">Invalid</a>
                                                </div>
                                                <div class="col-lg-6 mb-3 ">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                                        <span class="input-group-text "
                                                                        >Address</span>
                                                        </div>
                                                        <input type="text" class="form-control"
                                                               aria-label="Sizing example input"
                                                               aria-describedby="inputGroup-sizing-default"
                                                               id="address" name="address" th:value="${car.model}"
                                                               readonly>
                                                    </div>
                                                    <a class="validate-msg" id="addressValidate">Invalid</a>
                                                </div>
                                                <div class="input-group col-lg-6" style="min-height: 56px">
                                                    <span class="input-group-text" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">Description</span>
                                                    <textarea readonly class="form-control" id="description" aria-label="With textarea" th:text="${car.getDescription()}" style="font-size: 14px;" placeholder="Description of your vehicle"></textarea>
                                                </div>

                                                <div style="padding: 10px">
                                                    <div class="row pl-4 pr-4">
                                                        <th:block th:each="function : ${additionalFunction}">
                                                            <label class="checkbox bounce col-lg-3 col-md-4 col-6 p-0 d-flex" style="align-items: center;column-gap: 6px;">
                                                                <input type="checkbox"
                                                                       th:value="${function.functionId}"
                                                                       name="additionalFunction"
                                                                       th:checked="${car.getAdditionalFunctions() != null && car.additionalFunctions.contains(function)}" disabled>
                                                                <svg viewBox="0 0 21 21" disabled>
                                                                    <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
                                                                </svg>
                                                                <span th:text="${function.functionName}"></span>
                                                            </label>
                                                        </th:block>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-12 col-md-12 mb-3">
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <div class="input-group-text">
                                                                    <label class="form-check-label"
                                                                           style="padding: 0 10px;">
                                                                        Write here
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <input readonly type="text" class="form-control"
                                                                   aria-label="Text input with checkbox" id="termOfUse" th:value="${car.terms}">
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="nav-contact" role="tabpanel"
                                             aria-labelledby="nav-contact-tab">
                                            <div>
                                                <div class="row">

                                                </div>
                                            </div>
                                            <h5 class="card-title">My Wallet</h5>
                                            <div>
                                                <div class="row">
                                                    <div class="col-lg-12 col-md-12 mb-3">
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <div class="input-group-text">
                                                                    <label class="form-check-label"
                                                                           style="padding: 0 10px;">
                                                                        Current balance
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <input readonly type="text" class="form-control"
                                                                   aria-label="Text input with checkbox" id="currentBalance"
                                                                   th:value="${#numbers.formatDecimal(user.getWallet(), 0, 'COMMA', 0, 'POINT')} + ' VND'">
                                                        </div>
                                                    </div>
                                                    <span>Please make sure to have sufficient balance the car.</span>

                                                    <a href="/wallet/my-wallet">My Wallet</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen">
        <svg class="circular" width="48px" height="48px">
            <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
            <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                    stroke="#F96D00"/>
        </svg>
    </div>


    <script>
        const csrfToken = $('meta[name="_csrf"]').attr('content');




        //cancel button
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded and parsed");

            // Cancel Booking Button Event
            const cancelBookingBtn = document.getElementById('cancel-booking-btn'); // ID của nút Cancel
            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;

            if (cancelBookingBtn) {
                cancelBookingBtn.addEventListener('click', function (event) {
                    event.preventDefault();

                    // Lấy bookingId từ trường ẩn
                    const bookingId = document.getElementById('bookingId').value;

                    // Hiển thị hộp thoại xác nhận
                    Swal.fire({
                        title: 'Are you sure you want to cancel this booking?',
                        icon: 'warning',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        showCancelButton: true,
                        customClass: {
                            confirmButton: 'custom-confirm-btn',
                            cancelButton: 'custom-cancel-btn'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            console.log('User chose to cancel the booking with ID:', bookingId);

                            // Gửi yêu cầu xóa (bạn có thể dùng fetch hoặc window.location)
                            window.location.href = '/cancel-booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&navigate=' + navigate;
                        } else {
                            console.log('User canceled the booking action');
                        }
                    });
                });
            }
        });

        //Confirm pick-up
        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded and parsed");

            // Cancel Booking Button Event
            const cancelBookingBtn = document.getElementById('confirm-booking-btn'); // ID của nút Confirm
            const carId = document.getElementById("carId").value;
            const navigate = document.getElementById("navigate").value;

            if (cancelBookingBtn) {
                cancelBookingBtn.addEventListener('click', function (event) {
                    event.preventDefault();

                    // Lấy bookingId từ trường ẩn
                    const bookingId = document.getElementById('bookingId').value;

                    // Hiển thị hộp thoại xác nhận
                    Swal.fire({
                        title: 'Are you sure you want to confirm pick-up booking?',
                        icon: 'warning',
                        confirmButtonText: 'Yes',
                        cancelButtonText: 'No',
                        showCancelButton: true,
                        customClass: {
                            confirmButton: 'custom-confirm-btn',
                            cancelButton: 'custom-cancel-btn'
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            console.log('User chose to confirm the pick-up with ID:', bookingId);
                            // Gửi yêu cầu xóa (bạn có thể dùng fetch hoặc window.location)
                            window.location.href = '/confirm-pickup-booking-detail?bookingId=' + bookingId + '&carId=' + carId + '&navigate=' + navigate;
                      }
                    });
                });
            }
        });


        //====== Save data ======
        function checkData() {
            if(!checkStep()) {
                return;
            }
            updateBooking();
        }

        function checkStep() {
            // const pickupLocation = document.getElementById('pickupLocation').innerText;
            // const pickupDate = document.getElementById('pickupDate').innerText;
            // const returnDate = document.getElementById('returnDate').innerText;
            //
            // const pickupDateFormatted = formatToDatetimeDB(pickupDate);
            // const returnDateFormatted = formatToDatetimeDB(returnDate);

            // document.getElementById('editPickupLocation').value = pickupLocation;
            // document.getElementById('editPickupDate').value = pickupDateFormatted;
            // document.getElementById('editReturnDate').value = returnDateFormatted;

            // console.log("editPickupLocation:", document.getElementById("editPickupLocation").value);
            // console.log("editPickupDate:", document.getElementById("editPickupDate").value);
            // console.log("editReturnDate:", document.getElementById("editReturnDate").value);

            const currentDrivingLicense = document.getElementById("currentDrivingLicense").value // Dữ liệu từ DB
            let drivingLicense = document.getElementById("inputGroupFile011").value;
            console.log("currentDrivingLicense:",currentDrivingLicense);

            if(!drivingLicense) {
                drivingLicense = currentDrivingLicense;
            }

            console.log(drivingLicense)

            // Thu thập dữ liệu cho renter
            const formData = {
                // pickUpLocation: document.getElementById("editPickupLocation").value,
                // pickUpDateTime: pickupDateFormatted,
                // returnDateTime: returnDateFormatted,

                carId: document.getElementById("carId").value,
                fullName: document.getElementById("fullName").value,
                bookPickDate: document.getElementById("book_pick_date1").value,
                phone: document.getElementById("phone").value,
                email: document.getElementById("email").value,
                nationalId: document.getElementById("nationalId").value,
                drivingLicense: drivingLicense,
                province: document.getElementById("province").value,
                district: document.getElementById("district").value,
                ward: document.getElementById("ward").value,
                street: document.getElementById("street").value
            };

            console.log(formData);

            // Kiểm tra từng thuộc tính xem có bị trống không
            for (const key in formData) {
                if (formData[key] === '') {
                    console.log(`Trường ${key} đang bị trống.`);
                    // Nếu bạn muốn hiện cảnh báo cho người dùng, bạn có thể thêm dòng sau:
                    alert(`Vui lòng điền thông tin vào trường: ${key}`);
                    return false;

                }
            }
            return true;
        }

        function updateBooking() {

                // const pickupLocationTxt = document.getElementById('pickupLocation').innerText;
                // const pickupDate = document.getElementById('pickupDate').innerText;
                // const returnDate = document.getElementById('returnDate').innerText;
                //
                // const pickupDateFormatted = formatToDatetimeDB(pickupDate);
                // const returnDateFormatted = formatToDatetimeDB(returnDate);
                //
                // document.getElementById('editPickupLocation').value = pickupLocationTxt;
                // document.getElementById('editPickupDate').value = pickupDateFormatted;
                // document.getElementById('editReturnDate').value = returnDateFormatted;
                //
                // console.log("editPickupLocation:", document.getElementById("editPickupLocation").value);
                // console.log("editPickupDate:", document.getElementById("editPickupDate").value);
                // console.log("editReturnDate:", document.getElementById("editReturnDate").value);
                //==========================================================================

                // const pickUpLocation = pickupDateFormatted; document.getElementById("editPickupLocation").value;
                // const pickUpDateTime = pickupDateFormatted;
                // const returnDateTime = returnDateFormatted;
                // const depositValue = depositText.replace(/[^0-9]/g, '');
                const checked = document.getElementById("differentInfoCheckbox").checked;
                const carId = document.getElementById("carId").value;
                const bookingId = document.getElementById("bookingId").value;
                const fullName = document.getElementById('fullName').value;
                const bookPickDate = document.getElementById('book_pick_date1').value;
                const phone = document.getElementById('phone').value;
                const email = document.getElementById('email').value;
                const nationalId = document.getElementById("nationalId").value;
                const drivingLicense = document.getElementById("inputGroupFile011").value;
                const province =  document.getElementById('province').value
                const district =  document.getElementById('district').value;
                const ward =  document.getElementById('ward').value;
                const street = document.getElementById('street').value;

                // Lấy id của người dùng được chọn (nếu chỉ cho phép chọn một)
                let selectedUserId = null;
                const selectedCheckbox = document.querySelector('input[name="selectRow"]:checked');

                if (selectedCheckbox) {
                    selectedUserId = selectedCheckbox.value;
                }

                console.log("Selected User IDs:", selectedUserId);




                const bookingInfor = {
                    // location: pickUpLocation,
                    // pickUpDate: pickUpDateTime,
                    // returnDate: returnDateTime,
                    // deposit: depositValue,
                    // step: actualStep,
                    isCheck: checked,
                    carID: carId,
                    bookingId: bookingId,
                    rentFullName: fullName,
                    rentBookPickDate: bookPickDate,
                    rentPhone: phone,
                    rentMail: email,
                    rentNationalId: nationalId,
                    rentDrivingLicense: drivingLicense,
                    rentProvince: province,
                    rentDistrict: district,
                    rentWard: ward,
                    rentStreet: street,
                    selectedUserId: selectedUserId,
                };

                console.log(bookingInfor)
                // Tạo FormData
                const formData = new FormData();
                formData.append("bookingInfo", JSON.stringify(bookingInfor));

                const fileInputs = {
                    "drivingLicense": document.getElementById("inputGroupFile011"),
                };

                // Kiểm tra các file và thêm vào FormData
                for (const [key, input] of Object.entries(fileInputs)) {
                    if (input && input.files && input.files[0]) {
                        formData.append(key, input.files[0]);
                    } else {
                        formData.append(key, new Blob([], { type: 'application/octet-stream' }));
                    }
                }

                // Gửi AJAX request
                $.ajax({
                    url: '/update-booking-car',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    headers: {
                        'X-CSRF-TOKEN': csrfToken
                    },
                    success: function (response) {

                        // Lấy thông tin từ Map
                        const message = response.message;

                        if(message === "update successfully.") {
                            Swal.fire({
                                title: 'Registered successfully!',
                                text: 'Booking updated successfully',
                                icon: 'success',
                                confirmButtonText: 'OK',
                                customClass: {
                                    confirmButton: 'custom-confirm-btn'
                                }
                            });
                        }

                        console.log("Booking update successfully", message);
                        return true; // Thành công
                    },
                    error: function (xhr, status, error) {
                        if (xhr.status === 400) {
                            if(xhr.responseText === "Your wallet must be greater than deposit") {

                                const topUpLink = `<a href="/wallet/my-wallet" style="color: blue; text-decoration: underline;">Nạp tiền</a>`;
                                const errorMessage = `Ví của bạn không đủ tiền để đặt xe. ${topUpLink} để tiếp tục.`;

                                $('#error-message').html(errorMessage);
                            }
                            alert(xhr.responseText); // Hiển thị lỗi nếu có
                        } else {
                            console.log("Other Error:", error);
                        }
                        return false; // Thất bại
                    }
                });
        }

        const MAX_FILE_MB = 200;
        const MAX_SIZE_BYTES = MAX_FILE_MB * 1024 * 1024;

        function uploadfile(imageView, inputFile) {
            const file = inputFile.files[0];
            if (file) {
                const validExtensions = ["jpg", "jpeg", "png"];
                const fileExtension = file.name.split('.').pop().toLowerCase();
                if (file.size > MAX_SIZE_BYTES) {
                    alert("File size must be less than 200MB");
                    inputFile.value = ""; // Reset input nếu file không hợp lệ
                    return;
                }
                // Kiểm tra phần mở rộng file
                if (!validExtensions.includes(fileExtension)) {
                    alert("Only accept file type: .jpg, .jpeg, .png");
                    inputFile.value = ""; // Reset input nếu file không hợp lệ
                    return;
                }

                const fileReader = new FileReader();
                fileReader.onload = function (e) {
                    imageView.style.backgroundImage = `url(${e.target.result})`;
                    imageView.style.backgroundSize = "cover";
                    imageView.style.backgroundPosition = "center";
                    imageView.innerHTML = "";
                };
                fileReader.readAsDataURL(file); // Đọc file dưới dạng URL để hiển thị
            }
        }



        // Check if all fields are valid before enabling the "Next" button
        function checkValidations() {
            const saveButton = document.getElementById("save");

            // Collect error messages
            const emailError = document.getElementById("emailError").textContent;
            const phoneError1 = document.getElementById("phoneError").textContent;
            const dobError = document.getElementById("dateError").textContent;
            const nationalIdError = document.getElementById("nationalIdError").textContent;
            const fileNameError = document.getElementById("drivingLicenseError").textContent;

            // If all error messages are empty, enable the button; otherwise, disable it
            if (!emailError && !phoneError1 && !dobError && !nationalIdError && !fileNameError) {
                saveButton.disabled = false;
            } else {
                saveButton.disabled = true;
            }
        }

        // Email Validation
        function validateEmail() {
            const email = document.getElementById("email").value;
            const emailError = document.getElementById("emailError");
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
            if (!emailPattern.test(email)) {
                emailError.textContent = "Please enter a valid email address.";
            } else {
                emailError.textContent = "";
            }
            checkValidations();
        }

        // Phone Validation
        function validatePhone() {
            const phone1 = document.getElementById("phone").value;
            const phoneError1 = document.getElementById("phoneError");
            const phonePattern = /^(0|(\+84))?(3|5|7|8|9)\d{8}$/;
            if (!phonePattern.test(phone1)) {
                phoneError1.textContent = "Invalid phone number format.";
            } else {
                phoneError1.textContent = "";
            }
            checkValidations();
        }

        // Date of Birth Validation with 18+ Age Check
        function validateDate() {
            const dob = document.getElementById("book_pick_date1").value;
            const dobError = document.getElementById("dateError");
            const dobDate = new Date(dob);
            const today = new Date();
            const minAgeDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());

            if (!dob || dobDate > minAgeDate) {
                dobError.textContent = "You must be at least 18 years old.";
            } else {
                dobError.textContent = "";
            }
            checkValidations();
        }

        // National ID Validation
        function validateNationalId() {
            const nationalId = document.getElementById("nationalId").value;
            const nationalIdError = document.getElementById("nationalIdError");
            const nationalIdPattern = /^[0-9]{9,}$/;
            if (!nationalIdPattern.test(nationalId)) {
                nationalIdError.textContent = "Please enter a valid national ID.";
            } else {
                nationalIdError.textContent = "";
            }
            checkValidations();
        }

        // Driving License Validation
        function validateDrivingLicense() {
            const fileInput = document.getElementById("inputGroupFile011"); // Input file
            const fileNameDisplay = document.getElementById("fileName"); // Label hiển thị tên file
            const fileErrorDisplay = document.getElementById("drivingLicenseError"); // Vùng hiển thị lỗi
            const file = fileInput.files[0]; // File được chọn
            const validImageTypes = ["image/jpeg", "image/png", "image/gif"];

            // Reset thông báo lỗi và nhãn hiển thị
            fileErrorDisplay.textContent = "";

            if (file) {
                // Kiểm tra định dạng file
                if (!validImageTypes.includes(file.type)) {
                    fileNameDisplay.textContent = "Invalid file type. Please upload JPEG, PNG, or GIF.";
                    fileNameDisplay.style.color = "red";
                    fileInput.value = ""; // Reset input file nếu không hợp lệ
                    fileErrorDisplay.textContent = "Invalid file type.";
                } else {
                    // File hợp lệ
                    fileNameDisplay.textContent = `File selected: ${file.name}`;
                    fileNameDisplay.style.color = "green";
                    fileErrorDisplay.textContent = "";
                }
            } else {
                // Không có file nào được chọn
                fileErrorDisplay.textContent = "Please upload a driving license image.";
                fileNameDisplay.textContent = "Choose file";
                fileNameDisplay.style.color = "";
            }

            // Gọi hàm kiểm tra tổng hợp nếu cần
            checkAllValidations();
        }

        function toggleDriverInfoFields() {
            const checkbox = document.getElementById('differentInfoCheckbox');
            const table = document.getElementById('driverInfoTable');

            // Hiển thị bảng nếu checkbox được chọn
            table.style.display = checkbox.checked ? 'block' : 'none';
        }




        // Call API to fetch provinces, districts and wards
        // Fetch provinces and set default city
        async function fetchProvinces(defaultCity) {
            const response = await fetch('https://provinces.open-api.vn/api/p/');
            const provinces = await response.json();
            const citySelect = document.getElementById('province');

            provinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province.code;
                option.textContent = province.name;
                if (province.code == defaultCity) {
                    option.selected = true;
                }
                citySelect.appendChild(option);
            });

            if (defaultCity) {
                fetchDistricts(defaultCity, document.getElementById('district').getAttribute('data-default'));
            }
        }

        // Fetch districts based on selected province and set default value
        async function fetchDistricts(provinceCode, defaultDistrict) {
            const response = await fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`);
            const provinceData = await response.json();
            const districtSelect = document.getElementById('district');

            districtSelect.innerHTML = '<option value="">Select District</option>';
            provinceData.districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district.code;
                option.textContent = district.name;
                if (district.code == defaultDistrict) {
                    option.selected = true;
                }
                districtSelect.appendChild(option);
            });

            if (defaultDistrict) {
                fetchWards(defaultDistrict, document.getElementById('ward').getAttribute('data-default'));
            }
        }

        // Fetch wards based on selected district and set default value
        async function fetchWards(districtCode, defaultWard) {
            const response = await fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`);
            const districtData = await response.json();
            const wardSelect = document.getElementById('ward');

            wardSelect.innerHTML = '<option value="">Select Ward</option>';
            districtData.wards.forEach(ward => {
                const option = document.createElement('option');
                option.value = ward.code;
                option.textContent = ward.name;
                if (ward.code == defaultWard) {
                    option.selected = true;
                }
                wardSelect.appendChild(option);
            });
        }

        // Event listeners to load data on selection
        document.getElementById('province').addEventListener('change', function () {
            fetchDistricts(this.value);
            document.getElementById('ward').innerHTML = '<option value="">Select Ward</option>'; // Reset ward
            document.getElementById('district').disabled = this.value === ""; // Enable/disable district based on city selection
            document.getElementById('district').value = ""; // Reset district value
            document.getElementById('ward').disabled = true; // Disable ward selection
        });

        document.getElementById('district').addEventListener('change', function () {
            fetchWards(this.value);
            document.getElementById('ward').disabled = this.value === ""; // Enable/disable ward based on district selection
        });


        // Load provinces on page load with default values
        document.addEventListener('DOMContentLoaded', function () {
            const defaultCity = document.getElementById('province').getAttribute('data-default');
            fetchProvinces(defaultCity);
        });


        // //Load location
        // const province = document.getElementById('province');
        // const district = document.getElementById('district');
        // const ward = document.getElementById('district');
        // const previewLocation = document.getElementById('previewLocation');
        // ward.addEventListener('change', function(){
        //     previewLocation.textContent = province.options[province.selectedIndex].text + ', ' + district.options[district.selectedIndex].text + ', ' + ward.options[ward.selectedIndex].text;
        // });

        function selectOnlyOne(checkbox) {
            const checkboxes = document.querySelectorAll('input[name="selectRow"]');
            checkboxes.forEach((cb) => {
                if (cb !== checkbox) cb.checked = false;
            });
        }
        function checkDetails(){
            const mileage = document.getElementById('mileage').value;
            const fuelConsumption = document.getElementById('fuelConsumption').value;
            const province = document.getElementById('province').value;
            const district = document.getElementById('district').value;
            const ward = document.getElementById('ward').value;
            const street = document.getElementById('street').value;
            const checkedValues = [];
            const frontImage = document.getElementById("input-file4");
            const backImage = document.getElementById("input-file5");
            const leftImage = document.getElementById("input-file6")
            const rightImage = document.getElementById("input-file7")
            const frontImageUrl = document.getElementById('frontImage').value;
            const backImageUrl = document.getElementById('backImage').value;
            const leftImageUrl = document.getElementById('leftImage').value;
            const rightImageUrl = document.getElementById('rightImage').value;


            console.log(checkedValues);

            if (mileage === ''
                || fuelConsumption === ''
                || province === ''
                || district === ''
                || ward === ''
                || (frontImage.files.length === 0 && frontImageUrl === '')
                || (backImage.files.length === 0 && backImageUrl === '')
                || (leftImage.files.length === 0 && leftImageUrl === '')
                || (rightImage.files.length === 0 && rightImageUrl === '')) {
                alert('Please fill all required fields');
                return false;
            }
            return true;
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="/js/update-car-validate.js"></script>
    </body>
</th:block>
</body>
</html>
